KISSY.add("editor",function(z,q){function B(m,o){var a=this;if(!(a instanceof B))return new B(m,o);if(z.isString(m))m=z.one(m);m[0]||(m=new Node(m));a.cfg=o;z.app(a,z.EventTarget);a.use=function(c){z.use.call(a,c,function(){a.on("dataReady",function(){a.setData(m.val())})},{order:true,global:B})};a.init(m)}function s(m){if(!w)return"build/"+m.replace(/\.(js|css)/i,"-min.$1");if(w==="dev")return m;return"build/"+m}z.app(B,z.EventTarget);B.Config.base=z.Config.base+"editor/";var w=z.Config.debug,t=
{htmlparser:{attach:false,path:s("plugins/htmldataprocessor/htmlparser/htmlparser.js")}},p=["utils","focusmanager","definition","dtd","dom","elementpath","walker","range","domiterator","selection","styles"],u=["clipboard",{name:"color",useCss:true},{name:"elementpaths",useCss:true},"enterkey","fakeobjects",{name:"flash",requires:["fakeobjects","overlay"]},"font","format",{name:"htmldataprocessor",requires:["htmlparser-text"]},{name:"image",requires:["overlay"]},"indent","justify","link","list","maximize",
"music","preview","removeformat",{name:"smiley",useCss:true},"sourcearea",{name:"table",useCss:true,requires:["overlay","contextmenu"]},{name:"templates",requires:["overlay"],useCss:true},"undo"],e=[{name:"htmlparser-basicwriter",requires:["htmlparser"]},{name:"htmlparser-element",requires:["htmlparser-fragment"]},{name:"htmlparser-filter",requires:["htmlparser-element"]},{name:"htmlparser-fragment",requires:["htmlparser-htmlwriter"]},{name:"htmlparser-htmlwriter",requires:["htmlparser-basicwriter"]},
{name:"htmlparser-text",requires:["htmlparser-filter"]}],g=["button","overlay",{name:"contextmenu",requires:["overlay"]}],i,l,v,k;i=0;for(l=g.length;i<l;i++){v=g[i];k=q;if(!z.isString(v)){k=v.requires;v=v.name}t[v]={attach:false,requires:k,path:s("ui/"+v+".js"),csspath:s("ui/"+v+".css")}}i=0;for(l=u.length;i<l;i++){g=v=u[i];k=["button"];if(!z.isString(v)){v.requires&&(k=k.concat(v.requires));g=v.name}t[g]={attach:false,requires:k,csspath:v.useCss?s("plugins/"+g+"/plugin.css"):q,path:s("plugins/"+
g+"/plugin.js")}}i=0;for(l=e.length;i<l;i++){v=e[i];k=q;if(!z.isString(v)){k=v.requires;v=v.name}t[v]={attach:false,requires:k,path:s("plugins/htmldataprocessor/htmlparser/"+v.substring(11)+".js")}}B.add(t);t={};i=0;for(l=p.length;i<l;i++){v=p[i];t[v]={host:"editor",requires:i>0?p[i-1]:[]}}B.add(t);z.Editor=B});
KISSY.Editor.add("utils",function(z){var q=KISSY,B=q.Node,s=q.DOM,w=q.Config.debug;z.Utils={debugUrl:function(t){if(!w)return"build/"+t.replace(/\.(js|css)/i,"-min.$1");if(w==="dev")return t;return"build/"+t},lazyRun:function(t,p,u){var e=t[p],g=t[u];t[p]=function(){e.apply(this,arguments);t[p]=t[u];return g.apply(this,arguments)}},getXY:function(t,p,u,e){u=u.defaultView||u.parentWindow;t-=s.scrollLeft(u);p-=s.scrollTop(u);if(e)if(u!=(e.defaultView||e.parentWindow)&&u.frameElement){e=s._4e_getOffset(u.frameElement,
e);t+=e.left;p+=e.top}return{left:t,top:p}},tryThese:function(){for(var t,p=0,u=arguments.length;p<u;p++){var e=arguments[p];try{t=e();break}catch(g){}}return t},arrayCompare:function(t,p){if(!t&&!p)return true;if(!t||!p||t.length!=p.length)return false;for(var u=0;u<t.length;u++)if(t[u]!==p[u])return false;return true},getByAddress:function(t,p,u){t=t.documentElement;for(var e=0;t&&e<p.length;e++){var g=p[e];if(u)for(var i=-1,l=0;l<t.childNodes.length;l++){var v=t.childNodes[l];if(!(u===true&&v.nodeType==
3&&v.previousSibling&&v.previousSibling.nodeType==3)){i++;if(i==g){t=v;break}}}else t=t.childNodes[g]}return t?new B(t):null},clearAllMarkers:function(t){for(var p in t)t[p]._4e_clearMarkers(t,true)},htmlEncodeAttr:function(t){return t.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/,"&gt;")},ltrim:function(t){return t.replace(/^\s+/,"")},rtrim:function(t){return t.replace(/\s+$/,"")},trim:function(t){return this.ltrim(this.rtrim(t))},mix:function(){for(var t={},p=0;p<arguments.length;p++)t=
q.mix(t,arguments[p]);return t}}});KISSY.Editor.add("focusmanager",function(z){function q(){this.iframeFocus=true}function B(){this.iframeFocus=false}var s=KISSY,w=s.DOM,t=s.Event;s={};var p={};s.add=function(u){p[u._UUID]=u;var e=w._4e_getWin(u.document);t.on(e,"focus",q,u);t.on(e,"blur",B,u)};s.remove=function(u){delete p[u._UUID];var e=w._4e_getWin(u.document);t.remove(e,"focus",q,u);t.remove(e,"blur",B,u)};z.focusManager=s});
KISSY.Editor.add("definition",function(z){function q(){return g+"<html><head><title>kissy-editor</title><link href='"+z.Config.base+i+"' rel='stylesheet'/></head><body class='ke-editor'>&nbsp;</body><html>"}var B=KISSY,s=B.UA,w=B.DOM,t=B.Node,p=B.Event,u=z.focusManager,e=z.Utils.tryThese,g="<!doctype html>",i=z.Utils.debugUrl("assets/editor-iframe.css"),l=1,v="<div  class='ke-editor-wrap'  onmousedown=' return false;'  > <div class='"+".ke-editor-tools".substring(1)+"'></div><div class='"+".ke-textarea-wrap".substring(1)+
'\'><iframe  style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor"  src="'+(s.ie?"javascript:void(function(){"+encodeURIComponent("document.open();document.close();")+"}())":"")+'"  tabIndex="'+(s.webkit?-1:"$(tabIndex)")+'"  allowTransparency="true" ></iframe></div><div class=\''+".ke-editor-status".substring(1)+"'></div></div>";B.augment(z,{init:function(k){var m=this,o=new t(v.replace(/\$\(tabIndex\)/,k.attr("tabIndex")));m.editorWrap=o;
m._UUID=l++;m.wrap=o.one(".ke-textarea-wrap");m.iframe=m.wrap.one("iframe");m.toolBarDiv=o.one(".ke-editor-tools");m.textarea=k;m.statusDiv=o.one(".ke-editor-status");m.toolBarDiv._4e_unselectable();m._commands={};m._plugins={};var a=k._4e_style("width"),c=k._4e_style("height");if(a){o.css("width",a);k.css("width","100%")}m.textarea.css("display","none");o.insertAfter(k);m.wrap[0].appendChild(k[0]);if(c){m.wrap.css("height",c);k.css("height","100%")}k=m.iframe;m.on("dataReady",function(){m.ready=
true;z.fire("instanceCreated",{editor:m})});s.gecko?k.on("load",m._initIFrame,m):m._initIFrame()},addCommand:function(k,m){this._commands[k]=m},execCommand:function(k){this.fire("save");this._commands[k].exec(this);this.fire("save")},getData:function(){if(z.HtmlDataProcessor)return z.HtmlDataProcessor.toHtml(this.document.body.innerHTML,"p");return this.document.body.innerHTML},setData:function(k){if(z.HtmlDataProcessor)k=z.HtmlDataProcessor.toDataFormat(k,"p");this.document.body.innerHTML=k},sync:function(){this.textarea.val(this.getData())},
_getRawData:function(){return this.document.body.innerHTML},_setRawData:function(k){this.document.body.innerHTML=k},_hideSource:function(){this.iframe.css("display","");this.textarea.css("display","none");this.toolBarDiv.children().css("visibility","");this.statusDiv.children().css("visibility","")},_showSource:function(){this.textarea.css("display","");this.iframe.css("display","none");this.toolBarDiv.children().css("visibility","hidden");this.toolBarDiv.all(".ke-tool-editor-source").css("visibility",
"");this.statusDiv.children().css("visibility","hidden");s.ie<8&&this.textarea.css("height",this.wrap.css("height"))},_prepareIFrameHtml:q,getSelection:function(){var k=new z.Selection(this.document);return!k||k.isInvalid?null:k},focus:function(){var k=w._4e_getWin(this.document);s.webkit&&k&&k.parent&&k.parent.focus();k&&k.focus();this.document&&this.document.body.focus();this.notifySelectionChange()},blur:function(){w._4e_getWin(this.document).blur();this.document&&this.document.body.blur()},_initIFrame:function(){function k(x){e(function(){f.designMode=
"on";setTimeout(function(){f.designMode="off";h.focus();if(!arguments.callee.retry)arguments.callee.retry=true},50)},function(){f.designMode="off";w.attr(h,"contentEditable",false);w.attr(h,"contentEditable",true);!x&&k(1)})}var m=this,o=m.iframe,a=m.textarea[0],c=q(),j=o[0].contentWindow,f=j.document;m.document=f;o.detach();f.open("text/html","replace");f.write(c);f.close();var h=f.body;if(s.ie){h.hideFocus=true;h.disabled=true;h.contentEditable=true;h.removeAttribute("disabled")}else setTimeout(function(){if(s.gecko||
s.opera)h.contentEditable=true;else if(s.webkit)h.parentNode.contentEditable=true;else f.designMode="on"},0);try{f.execCommand("enableObjectResizing",false,true)}catch(r){}try{f.execCommand("enableInlineTableEditing",false,true)}catch(b){}s.webkit&&p.on(f,"mousedown",function(x){x=new t(x.target);B.inArray(x._4e_name(),["img","hr","input","textarea","select"])&&m.getSelection().selectElement(x)});if(s.webkit){p.on(f,"click",function(x){var C=new t(x.target);B.inArray(C._4e_name(),["input","select"])&&
x.preventDefault()});p.on(f,"mouseup",function(x){var C=new t(x.target);B.inArray(C._4e_name(),["input","textarea"])&&x.preventDefault()})}if(s.gecko||s.ie||s.opera){var d;d=new t(w.insertAfter((new t('<span style="position:absolute; left:-10000"></span>'))[0],a));d.on("focus",function(){m.focus()});m.on("destroy",function(){})}if(s.ie&&f.compatMode=="CSS1Compat"||s.gecko||s.opera){var n=new t(f.documentElement);n.on("mousedown",function(x){if(x.target===n[0]){s.gecko&&k(false);d[0].focus()}})}p.on(j,
"focus",function(){if(s.gecko)k(false);else s.opera&&h.focus();m.notifySelectionChange()});s.gecko&&p.on(m.document,"mousedown",function(){m.iframeFocus||k(false)});if(s.ie){p.on(f,"keydown",function(x){if(x.keyCode in{8:1,46:1}){var C=m.getSelection(),I=C.getSelectedElement();if(I){m.fire("save");var y=C.getRanges()[0].createBookmark();I.remove();C.selectBookmarks([y]);m.fire("save");x.preventDefault()}}});if(f.compatMode=="CSS1Compat"){var A={33:1,34:1};p.on(f,"keydown",function(x){x.keyCode in
A&&setTimeout(function(){m.getSelection().scrollIntoView()},0)})}}setTimeout(function(){s.ie&&setTimeout(function(){if(f){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){m.fire("dataReady")},10);u.add(m)},addPlugin:function(k){this.ready?k():this.on("dataReady",k)},_monitor:function(){var k=this;k._monitorId&&clearTimeout(k._monitorId);k._monitorId=setTimeout(function(){var m=k.getSelection();if(m&&!m.isInvalid){m=m.getStartElement();var o=new z.ElementPath(m);
if(!k.previousPath||!k.previousPath.compare(o)){k.previousPath=o;k.fire("selectionChange",{selection:k,path:o,element:m})}}},200)},notifySelectionChange:function(){this.previousPath=null;this._monitor()},insertElement:function(k){var m=this;m.focus();var o=k._4e_name(),a=z.XHTML_DTD,c=z.RANGE,j=z.NODE,f=a.$block[o],h=m.getSelection(),r=h.getRanges(),b,d,n,A,x;m.fire("save");for(var C=r.length-1;C>=0;C--){b=r[C];b.deleteContents();d=!C&&k||k._4e_clone(true);if(f)for(;(A=b.getCommonAncestor(false,true))&&
(x=a[A._4e_name()])&&!(x&&x[o]);)if(A._4e_name()in a.span)b.splitElement(A);else if(b.checkStartOfBlock()&&b.checkEndOfBlock()){b.setStartBefore(A);b.collapse(true);A.remove()}else b.splitBlock();b.insertNode(d);n||(n=d)}b.moveToPosition(n,c.POSITION_AFTER_END);(k=n._4e_nextSourceNode(true))&&k.type==j.NODE_ELEMENT&&b.moveToElementEditablePosition(k);h.selectRanges([b]);m.focus();d&&d._4e_scrollIntoView();setTimeout(function(){m.fire("save")},10)},insertHtml:function(k){if(z.HtmlDataProcessor)k=z.HtmlDataProcessor.toDataFormat(k);
if(s.webkit){k=w.create(k,null,this.document);k=k.nodeType==11?B.makeArray(k.childNodes):[k];for(var m=0;m<k.length;m++)this.insertElement(new t(k[m]))}else{var o=this;o.focus();o.fire("save");m=o.getSelection();if(s.ie){m=m.getNative();m.type=="Control"&&m.clear();m.createRange().pasteHTML(k)}else o.document.execCommand("inserthtml",false,k);o.focus();setTimeout(function(){o.fire("save")},10)}}})});
KISSY.Editor.add("dtd",function(z){z.XHTML_DTD=function(){var q=function(r){for(var b=arguments.length-1;b>0;)KISSY.mix(r,arguments[b--]);return r},B={isindex:1,fieldset:1},s={input:1,button:1,select:1,textarea:1,label:1},w=q({a:1},s),t=q({iframe:1},w),p={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},u={ins:1,del:1,script:1,style:1},e=q({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,
u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},u),g=q({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},e),i=q({p:1},g);s=q({iframe:1},g,s);g={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,
dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1};var l=q({a:1},s),v={tr:1},k={"#":1},m=q({param:1},g),o=q({form:1},B,t,p,i),a={li:1},c={base:1,link:1,meta:1,title:1},j=q(c,{style:1,script:1}),f={head:1,body:1},h={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:q({html:1},f,c),$block:h,
$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:l,$body:q({script:1,style:1},h),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:f,head:j,style:k,body:o,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:o,td:o,br:{},th:o,center:o,kbd:l,button:q(i,p),basefont:{},h5:l,h4:l,samp:l,h6:l,ol:a,h1:l,h3:l,option:k,h2:l,form:q(B,t,p,i),select:{optgroup:1,option:1},font:l,ins:l,menu:a,abbr:l,label:l,table:{thead:1,
col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:l,script:k,tfoot:v,cite:l,li:o,input:{},iframe:o,strong:l,textarea:k,noframes:o,big:l,small:l,span:l,hr:{},dt:l,sub:l,optgroup:{option:1},param:{},bdo:l,"var":l,div:o,object:m,sup:l,dd:o,strike:l,area:{},dir:a,map:q({area:1,form:1,p:1},B,u,p),applet:m,dl:{dt:1,dd:1},del:l,isindex:{},fieldset:q({legend:1},g),thead:v,ul:a,acronym:l,b:l,a:s,blockquote:o,caption:l,i:l,u:l,tbody:v,s:l,address:q(t,i),tt:l,legend:l,q:l,pre:q(e,w),p:l,em:l,dfn:l}}()});
KISSY.Editor.add("dom",function(z){function q(a){return a.replace(/-(\w)/g,function(c,j){return j.toUpperCase()})}var B=KISSY,s=B.DOM,w=B.UA,t=B.Node,p=z.Utils,u={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};z.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_DOCUMENT_FRAGMENT:11};z.POSITION={};var e=z.NODE,g=z.POSITION;g.POSITION_IDENTICAL=0;g.POSITION_DISCONNECTED=1;g.POSITION_FOLLOWING=
2;g.POSITION_PRECEDING=4;g.POSITION_IS_CONTAINED=8;g.POSITION_CONTAINS=16;var i={},l={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},v={hr:1},k=function(a){return a[0]||a},m=function(a){if(!a[0])return new t(a);return a},o={_4e_equals:function(a,c){if(!a&&!c)return true;if(!a||!c)return false;a=k(a);c=k(c);return a===c},_4e_isBlockBoundary:function(a,c){a=m(a);c=
B.mix(B.mix({},v),c||{});return l[a.css("display")]||c[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=k(a);for(var c=a.parentNode.childNodes,j=0;j<c.length;j++)if(c[j]===a)return j;return-1},_4e_first:function(a,c){a=k(a);if((a=(a=a.firstChild)&&new t(a))&&c&&!c(a))a=a._4e_next(c);return a},_4e_move:function(a,c,j){a.remove();a=k(a);c=k(c);j?c.insertBefore(a,c.firstChild):c.appendChild(a)},
_4e_name:function(a){a=k(a);return a.nodeName.toLowerCase()},_4e_isIdentical:function(a,c){if(a._4e_name()!=c._4e_name())return false;var j=a[0].attributes,f=c[0].attributes,h=j.length,r=f.length;if(!w.ie&&h!=r)return false;for(var b=0;b<h;b++){var d=j[b];if((!w.ie||d.specified&&d.nodeName!="_ke_expando")&&d.nodeValue!=c.attr(d.nodeName))return false}if(w.ie)for(b=0;b<r;b++){d=f[b];if(d.specified&&d.nodeName!="_ke_expando"&&d.nodeValue!=a.attr(d.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=
k(a).childNodes;for(var c=0,j=a.length;c<j;c++){var f=a[c],h=f.nodeType;if(!(h==e.NODE_ELEMENT&&f.getAttribute("_ke_bookmark")))if(h==e.NODE_ELEMENT&&!o._4e_isEmptyInlineRemoveable(f)||h==e.NODE_TEXT&&B.trim(f.nodeValue))return false}return true},_4e_moveChildren:function(a,c,j){a=k(a);c=c[0]||c;if(a!=c)if(j)for(;j=a.lastChild;)c.insertBefore(a.removeChild(j),c.firstChild);else for(;j=a.firstChild;)c.appendChild(a.removeChild(j))},_4e_mergeSiblings:function(){function a(c,j,f){if(j[0]&&j[0].nodeType==
e.NODE_ELEMENT){for(var h=[];j.attr("_ke_bookmark")||j._4e_isEmptyInlineRemoveable();){h.push(j);j=f?new t(j[0].nextSibling):new t(j[0].previousSibling);if(!j[0]||j[0].nodeType!=e.NODE_ELEMENT)return}if(c._4e_isIdentical(j)){for(var r=f?c[0].lastChild:c[0].firstChild;h.length;)h.shift()._4e_move(c,!f);j._4e_moveChildren(c,!f);j.remove();r[0]&&r[0].nodeType==e.NODE_ELEMENT&&r._4e_mergeSiblings()}}}return function(c){if(c[0])if(u[c._4e_name()]||c._4e_name()=="a"){a(c,new t(c[0].nextSibling),true);a(c,
new t(c[0].previousSibling))}}}(),_4e_unselectable:w.gecko?function(a){a=k(a);a.style.MozUserSelect="none"}:w.webkit?function(a){a=k(a);a.style.KhtmlUserSelect="none"}:function(a){a=k(a);if(w.ie||w.opera){var c,j=0;for(a.unselectable="on";c=a.all[j++];)switch(c.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:c.unselectable="on"}}},_4e_getOffset:function(a,c){a=k(a);var j,f=0;j=0;var h=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,r=a.ownerDocument,
b=r.documentElement;if(a.getBoundingClientRect){if(a!==r.body&&b!==a){j=a.getBoundingClientRect();f=j.left+s.scrollLeft(h);j=j.top+s.scrollTop(h)}if(c)if(h!=(c.defaultView||c.parentWindow)&&h.frameElement){c=o._4e_getOffset(h.frameElement,c);f+=c.left;j+=c.top}}return{left:f,top:j}},_4e_getFrameDocument:function(a){return(a=k(a))&&a.contentWindow.document},_4e_splitText:function(a,c){a=k(a);var j=a.ownerDocument;if(!(!a||a.nodeType!=e.NODE_TEXT)){if(w.ie&&c==a.nodeValue.length){j=j.createTextNode("");
s.insertAfter(j,a);return j}a=new t(a.splitText(c));if(w.ie==8){j=j.createTextNode("");s.insertAfter(j,a[0]);j.parentNode.removeChild(j)}return a}},_4e_parents:function(a,c){a=m(a);var j=[];do j[c?"push":"unshift"](a);while(a=a.parent());return j},_4e_clone:function(a,c,j){a=k(a);a=a.cloneNode(c);if(!j){var f=function(h){if(h.nodeType==e.NODE_ELEMENT){h.removeAttribute("id",false);h.removeAttribute("_ke_expando",false);h=h.childNodes;for(var r=0;r<h.length;r++)f(h[r])}};f(a)}return new t(a)},_4e_nextSourceNode:function(a,
c,j,f){a=k(a);if(f&&!f.call){var h=f[0]||f;f=function(b){b=b[0]||b;return b!==h}}c=!c&&a.firstChild;var r=new t(a);if(!c){if(a.nodeType==e.NODE_ELEMENT&&f&&f(this,true)===false)return null;c=a.nextSibling}for(;!c&&(r=r.parent());){if(f&&f(r,true)===false)return null;c=r[0].nextSibling}if(!c)return null;c=new t(c);if(f&&f(c)===false)return null;if(j&&j!=c[0].nodeType)return c._4e_nextSourceNode(false,j,f);return c},_4e_previousSourceNode:function(a,c,j,f){a=k(a);if(f&&!f.call){var h=f[0]||f;f=function(b){b=
b[0]||b;return b!==h}}c=!c&&a.lastChild;var r=new t(a);if(!c){if(a.nodeType==e.NODE_ELEMENT&&f&&f(a,true)===false)return null;c=a.previousSibling}for(;!c&&(r=r.parent());){if(f&&f(r,true)===false)return null;c=r[0].previousSibling}if(!c)return null;c=new t(c);if(f&&f(c)===false)return null;if(j&&c[0].nodeType!=j)return c._4e_previousSourceNode(false,j,f);return c},_4e_contains:w.ie||w.webkit?function(a,c){a=k(a);c=k(c);return c.nodeType!=e.NODE_ELEMENT?a.contains(c.parentNode):a!=c&&a.contains(c)}:
function(a,c){a=k(a);c=k(c);return!!(a.compareDocumentPosition(c)&16)},_4e_commonAncestor:function(a,c){if(a._4e_equals(c))return a;if(c[0].nodeType!=e.NODE_TEXT&&c._4e_contains(a))return c;a=a[0].nodeType==e.NODE_TEXT?a.parent():a;do if(a[0].nodeType!=e.NODE_TEXT&&a._4e_contains(c))return a;while(a=a.parent());return null},_4e_ascendant:function(a,c,j){a=k(a);if(!j)a=a.parentNode;if(c&&!B.isFunction(c)){var f=c;c=function(h){return h._4e_name()==f}}for(;a&&a.nodeType!=9;){if(!c||c(new t(a))===true)return new t(a);
a=a.parentNode}return null},_4e_hasAttribute:function(a,c){a=k(a);a=a.attributes.getNamedItem(c);return!!(a&&a.specified)},_4e_hasAttributes:w.ie?function(a){a=k(a);for(var c=a.attributes,j=0;j<c.length;j++){var f=c[j];switch(f.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(f.specified)return true}}return false}:function(a){a=k(a);w.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},
_4e_position:function(a,c){var j=k(a),f=k(c);if(j.compareDocumentPosition)return j.compareDocumentPosition(f);if(j==f)return g.POSITION_IDENTICAL;if(j.nodeType==e.NODE_ELEMENT&&f.nodeType==e.NODE_ELEMENT){if(j.contains){if(j.contains(f))return g.POSITION_CONTAINS+g.POSITION_PRECEDING;if(f.contains(j))return g.POSITION_IS_CONTAINED+g.POSITION_FOLLOWING}if("sourceIndex"in j)return j.sourceIndex<0||f.sourceIndex<0?g.POSITION_DISCONNECTED:j.sourceIndex<f.sourceIndex?g.POSITION_PRECEDING:g.POSITION_FOLLOWING}a=
a._4e_address();c=c._4e_address();j=Math.min(a.length,c.length);for(f=0;f<=j-1;f++)if(a[f]!=c[f]){if(f<j)return a[f]<c[f]?g.POSITION_PRECEDING:g.POSITION_FOLLOWING;break}return a.length<c.length?g.POSITION_CONTAINS+g.POSITION_PRECEDING:g.POSITION_IS_CONTAINED+g.POSITION_FOLLOWING},_4e_address:function(a,c){a=k(a);var j=[],f=a.ownerDocument.documentElement;for(a=a;a&&a!=f;){var h=a.parentNode,r=-1;if(h){for(var b=0;b<h.childNodes.length;b++){var d=h.childNodes[b];if(!(c&&d.nodeType==3&&d.previousSibling&&
d.previousSibling.nodeType==3)){r++;if(d==a)break}}j.unshift(r)}a=h}return j},_4e_breakParent:function(a,c){var j=new z.Range(a[0].ownerDocument);j.setStartAfter(a);j.setEndAfter(c);c=j.extractContents();j.insertNode(a.remove());a[0].parentNode.insertBefore(c,a[0].nextSibling)},_4e_style:function(a,c,j){if(j!==undefined)return a.css(c,j);a=a[0]||a;return a.style[q(c)]},_4e_remove:function(a,c){a=k(a);var j=a.parentNode;if(j){if(c)for(;c=a.firstChild;)j.insertBefore(a.removeChild(c),a);j.removeChild(a)}return this},
_4e_trim:function(a){s._4e_ltrim(a);s._4e_rtrim(a)},_4e_ltrim:function(a){a=k(a);for(var c;c=a.firstChild;){if(c.nodeType==e.NODE_TEXT){var j=p.ltrim(c.nodeValue),f=c.nodeValue.length;if(j){if(j.length<f){(new t(c))._4e_splitText(f-j.length);a.removeChild(a.firstChild)}}else{a.removeChild(c);continue}}break}},_4e_rtrim:function(a){a=k(a);for(var c;c=a.lastChild;){if(c.type==e.NODE_TEXT){var j=p.rtrim(c.nodeValue),f=c.nodeValue.length;if(j){if(j.length<f){(new t(c))._4e_splitText(j.length);a.removeChild(a.lastChild)}}else{a.removeChild(c);
continue}}break}if(!w.ie&&!w.opera)(c=a.lastChild)&&c.nodeType==1&&c.nodeName.toLowerCase()=="br"&&c.parentNode.removeChild(c)},_4e_appendBogus:function(a){a=k(a);for(var c=a.lastChild;c&&c.nodeType==e.NODE_TEXT&&!B.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==e.NODE_TEXT||s._4e_name(c)!=="br"){c=w.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");w.gecko&&c.setAttribute("type","_moz");a.appendChild(c)}},_4e_previous:function(a,c){a=k(a);var j;do j=(a=a.previousSibling)&&
new t(a);while(j&&c&&!c(j));return j},_4e_last:function(a,c){if((a=(a=a[0].lastChild)&&new t(a))&&c&&!c(a))a=a._4e_previous(c);return a},_4e_next:function(a,c){a=k(a);var j;do j=(a=a.nextSibling)&&new t(a);while(j&&c&&!c(j));return j},_4e_outerHtml:function(a){a=k(a);if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML},_4e_setMarker:function(a,c,j,f){a[0]||(a=new t(a));var h=a._4e_getData("list_marker_id")||
a._4e_setData("list_marker_id",B.guid())._4e_getData("list_marker_id"),r=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");c[h]=a;r[j]=1;return a._4e_setData(j,f)},_4e_clearMarkers:function(a,c,j){a=m(a);var f=a._4e_getData("list_marker_names"),h=a._4e_getData("list_marker_id");for(var r in f)a._4e_removeData(r);a._4e_removeData("list_marker_names");if(j){a._4e_removeData("list_marker_id");delete c[h]}},_4e_setData:function(a,c,j){var f=s._4e_getUniqueId(a);
(i[f]||(i[f]={}))[c]=j;return a},_4e_getData:function(a,c){a=k(a);return(a=(a=a.getAttribute("_ke_expando"))&&i[a])&&a[c]},_4e_removeData:function(a,c){a=k(a);var j=a.getAttribute("_ke_expando");var f=(j=j&&i[j])&&j[c];typeof f!="undefined"&&j&&delete j[c];B.isEmptyObject(j)&&s._4e_clearData(a);return f||null},_4e_clearData:function(a){a=k(a);var c=a.getAttribute("_ke_expando");c&&delete i[c];c&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=k(a);var c=a.getAttribute("_ke_expando");
if(c)return c;c=B.guid();a.setAttribute("_ke_expando",c);return c},_4e_copyAttributes:function(a,c,j){a=k(a);var f=a.attributes;j=j||{};for(var h=0;h<f.length;h++){var r=f[h],b=r.nodeName.toLowerCase(),d;if(!(b in j))if(b=="checked"&&(d=s.attr(a,b)))c.attr(b,d);else if(r.specified||w.ie&&r.nodeValue&&b=="value"){d=s.attr(a,b);if(d===null)d=r.nodeValue;c.attr(b,d)}}if(a.style.cssText!=="")c[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=s._4e_name(a);var c=z.XHTML_DTD;return(a=!c.$nonEditable[a]&&
(c[a]||c.span))&&a["#"]},_4e_scrollIntoView:function(a){a=m(a);var c=a[0].ownerDocument,j=s.scrollLeft(c),f=s.scrollTop(c),h=a.offset(),r=h.left;h=h.top;if(s.viewportHeight(c)+f<h||h<f||s.viewportWidth(c)+j<r||r<j)a.scrollIntoView(c)}};B.DOM._4e_inject=function(a){B.mix(s,a);for(var c in a)a.hasOwnProperty(c)&&function(j){t.prototype[j]=function(){var f=[].slice.call(arguments,0);f.unshift(this);return a[j].apply(null,f)}}(c)};B.DOM._4e_inject(o)});
KISSY.Editor.add("elementpath",function(z){function q(i){var l=null,v=null,k=[];for(i=i;i&&i[0];){if(i[0].nodeType==t.NODE_ELEMENT){if(!this.lastElement)this.lastElement=i;var m=i._4e_name();if(p.ie&&i[0].scopeName!="HTML")m=i[0].scopeName.toLowerCase()+":"+m;if(!v){if(!l&&u[m])l=i;if(e[m])if(!l&&m=="div"&&!g(i))l=i;else v=i}k.push(i);if(m=="body")break}i=i.parent()}this.block=l;this.blockLimit=v;this.elements=k}var B=KISSY,s=B.DOM,w=z.XHTML_DTD,t=z.NODE,p=B.UA,u={address:1,blockquote:1,dl:1,h1:1,
h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},e={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1},g=function(i){i=i[0]||i;i=i.childNodes;for(var l=0,v=i.length;l<v;l++){var k=i[l];if(k.nodeType==t.NODE_ELEMENT&&w.$block[k.nodeName.toLowerCase()])return true}return false};q.prototype={compare:function(i){var l=this.elements;i=i&&i.elements;if(!i||l.length!=i.length)return false;for(var v=0;v<l.length;v++)if(!s._4e_equals(l[v],i[v]))return false;return true},contains:function(i){for(var l=
this.elements,v=0;v<l.length;v++)if(l[v]._4e_name()in i)return l[v];return null}};z.ElementPath=q});
KISSY.Editor.add("walker",function(z){function q(e,g){if(this._.end)return null;var i=this.range,l,v=this.guard,k=this.type,m=e?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;i.trim();if(i.collapsed){this.end();return null}}if(!e&&!this._.guardLTR){var o=i.endContainer,a=new u(o[0].childNodes[i.endOffset]);this._.guardLTR=function(h,r){return(!r||!p._4e_equals(o,h))&&(!a[0]||h[0]!==a[0])&&(h[0].nodeType!=t.NODE_ELEMENT||!r||h._4e_name()!="body")}}if(e&&!this._.guardRTL){var c=
i.startContainer,j=i.startOffset>0&&new u(c[0].childNodes[i.startOffset-1]);this._.guardRTL=function(h,r){return h&&h[0]&&(!r||c[0]!==h[0])&&(!j[0]||h[0]!==j[0])&&(h[0].nodeType!=t.NODE_ELEMENT||!r||h._4e_name()!="body")}}var f=e?this._.guardRTL:this._.guardLTR;l=v?function(h,r){if(f(h,r)===false)return false;return v(h,r)}:f;if(this.current)e=this.current[m](false,k,l);else if(e){e=i.endContainer;if(i.endOffset>0){e=new u(e[0].childNodes[i.endOffset-1]);if(l(e)===false)e=null}else e=l(e,true)===
false?null:e._4e_previousSourceNode(true,k,l)}else{e=i.startContainer;if((e=new u(e[0].childNodes[i.startOffset]))&&e[0]){if(l(e)===false)e=null}else e=l(i.startContainer,true)===false?null:i.startContainer._4e_nextSourceNode(true,k,l)}for(;e&&e[0]&&!this._.end;){this.current=e;if(!this.evaluator||this.evaluator(e)!==false){if(!g)return e}else if(g&&this.evaluator)return false;e=e[m](false,k,l)}this.end();return this.current=null}function B(e){for(var g,i=null;g=q.call(this,e);)i=g;return i}function s(e){this.range=
e;this._={}}var w=KISSY,t=z.NODE,p=w.DOM,u=w.Node;w.augment(s,{end:function(){this._.end=1},next:function(){return q.call(this)},previous:function(){return q.call(this,true)},checkForward:function(){return q.call(this,false,true)!==false},checkBackward:function(){return q.call(this,true,true)!==false},lastForward:function(){return B.call(this)},lastBackward:function(){return B.call(this,true)},reset:function(){delete this.current;this._={}}});s.blockBoundary=function(e){return function(g){g[0]||(g=
new u(g));return!(g[0].nodeType==t.NODE_ELEMENT&&g._4e_isBlockBoundary(e))}};s.listItemBoundary=function(){return this.blockBoundary({br:1})};s.bookmark=function(e,g){function i(l){return l&&l[0]&&l._4e_name()=="span"&&l.attr("_ke_bookmark")}return function(l){var v,k;v=l&&l[0]&&l[0].nodeType==t.NODE_TEXT&&(k=l.parent())&&i(k);v=e?v:v||i(l);return g^v}};s.whitespaces=function(e){return function(g){g=(g=g[0]||g)&&g.nodeType==t.NODE_TEXT&&!w.trim(g.nodeValue);return e^g}};s.invisible=function(e){var g=
s.whitespaces();return function(i){i=g(i)||i[0].nodeType==t.NODE_ELEMENT&&!i[0].offsetHeight;return e^i}};z.Walker=s});
KISSY.Editor.add("range",function(z){function q(b){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;this.collapsed=true;this.document=b}function B(b){var d=b[0].nodeType!=e.NODE_TEXT&&b._4e_name()in o.$removeEmpty,n=!u.trim(b[0].nodeValue);b=!!b.parent().attr("_ke_bookmark");return d||n||b}function s(b){return!h(b)&&!r(b)}function w(b){var d=false,n=l.bookmark(true);return function(A){if(n(A))return true;if(A[0].nodeType==e.NODE_TEXT){if(u.trim(A[0].nodeValue).length)return false}else if(A[0].nodeType==
e.NODE_ELEMENT)if(!f[A._4e_name()])if(!b&&!m.ie&&A._4e_name()=="br"&&!d)d=true;else return false;return true}}function t(b,d){function n(A){return A&&A.nodeName=="span"&&A.getAttribute("_ke_bookmark")}return function(A){var x,C;x=A&&!A.nodeName&&(C=A.parentNode)&&n(C);x=b?x:x||n(A);return d^x}}function p(b){return function(d){d=(d=d[0]||d)&&d.nodeType==e.NODE_TEXT&&!u.trim(d.nodeValue);return b^d}}z.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,
ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var u=KISSY,e=z.NODE,g=z.RANGE,i=z.POSITION,l=z.Walker,v=u.DOM,k=z.Utils.getByAddress,m=u.UA,o=z.XHTML_DTD,a=z.ElementPath,c=u.Node,j={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1};q.prototype.toString=function(){var b=[];b.push((this.startContainer[0].id||this.startContainer[0].nodeName)+":"+this.startOffset);b.push((this.endContainer[0].id||this.endContainer[0].nodeName)+
":"+this.endOffset);return b.join("<br/>")};u.augment(q,{updateCollapsed:function(){this.collapsed=this.startContainer&&this.endContainer&&v._4e_equals(this.startContainer,this.endContainer)&&this.startOffset==this.endOffset},optimize:function(){var b=this.startContainer,d=this.startOffset;if(b[0].nodeType!=e.NODE_ELEMENT)if(d)d>=b[0].nodeValue.length&&this.setStartAfter(b);else this.setStartBefore(b);b=this.endContainer;d=this.endOffset;if(b[0].nodeType!=e.NODE_ELEMENT)if(d)d>=b[0].nodeValue.length&&
this.setEndAfter(b);else this.setEndBefore(b)},setStartAfter:function(b){this.setStart(b.parent(),b._4e_index()+1)},setStartBefore:function(b){this.setStart(b.parent(),b._4e_index())},setEndAfter:function(b){this.setEnd(b.parent(),b._4e_index()+1)},setEndBefore:function(b){this.setEnd(b.parent(),b._4e_index())},optimizeBookmark:function(){var b=this.startContainer,d=this.endContainer;b&&b._4e_name()=="span"&&b.attr("_ke_bookmark")&&this.setStartAt(b,g.POSITION_BEFORE_START);d&&d._4e_name()=="span"&&
d.attr("_ke_bookmark")&&this.setEndAt(d,g.POSITION_AFTER_END)},setStart:function(b,d){if(b[0].nodeType==e.NODE_ELEMENT&&j[b._4e_name()]){b=b.parent();d=b._4e_index()}this.startContainer=b;this.startOffset=d;if(!this.endContainer){this.endContainer=b;this.endOffset=d}this.updateCollapsed()},setEnd:function(b,d){if(b[0].nodeType==e.NODE_ELEMENT&&j[b._4e_name()]){b=b.parent();d=b._4e_index()+1}this.endContainer=b;this.endOffset=d;if(!this.startContainer){this.startContainer=b;this.startOffset=d}this.updateCollapsed()},
setStartAt:function(b,d){switch(d){case g.POSITION_AFTER_START:this.setStart(b,0);break;case g.POSITION_BEFORE_END:b[0].nodeType==e.NODE_TEXT?this.setStart(b,b[0].nodeValue.length):this.setStart(b,b[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(b);break;case g.POSITION_AFTER_END:this.setStartAfter(b)}this.updateCollapsed()},setEndAt:function(b,d){switch(d){case g.POSITION_AFTER_START:this.setEnd(b,0);break;case g.POSITION_BEFORE_END:b[0].nodeType==e.NODE_TEXT?this.setEnd(b,
b[0].nodeValue.length):this.setEnd(b,b[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(b);break;case g.POSITION_AFTER_END:this.setEndAfter(b)}this.updateCollapsed()},execContentsAction:function(b,d){var n=this.startContainer,A=this.endContainer,x=this.startOffset,C=this.endOffset,I,y;this.optimizeBookmark();if(A[0].nodeType==e.NODE_TEXT)A=A._4e_splitText(C);else if(A[0].childNodes.length>0)if(C>=A[0].childNodes.length){A=new c(A[0].appendChild(this.document.createTextNode("")));
y=true}else A=new c(A[0].childNodes[C]);if(n[0].nodeType==e.NODE_TEXT){n._4e_splitText(x);if(v._4e_equals(n,A))A=new c(n[0].nextSibling)}else if(x)if(x>=n[0].childNodes.length){I=new c(this.document.createTextNode(""));n[0].appendChild(I[0]);n=I;I=true}else n=new c(n[0].childNodes[x].previousSibling);else{I=new c(this.document.createTextNode(""));v.insertBefore(I[0],n[0].firstChild);n=I;I=true}x=n._4e_parents();C=A._4e_parents();var D,G,J;for(D=0;D<x.length;D++){G=x[D];J=C[D];if(G[0]!==J[0])break}for(var N=
d,M,Q,R,W=D;W<x.length;W++){M=x[W];if(N&&M[0]!==n[0])Q=N.appendChild(M._4e_clone()[0]);for(M=M[0].nextSibling;M;){if(C[W]&&M==C[W][0]||M==A[0])break;R=M.nextSibling;if(b==2)N.appendChild(M.cloneNode(true));else{M.parentNode.removeChild(M);b==1&&N.appendChild(M)}M=R}if(Q)N=Q}N=d;for(d=D;d<C.length;d++){M=C[d];if(b>0&&M[0]!==A[0])Q=N.appendChild(M._4e_clone()[0]);if(!x[d]||M[0].parentNode!==x[d][0].parentNode)for(M=M[0].previousSibling;M;){if(x[d]&&M==x[d][0]||M===n[0])break;R=M.previousSibling;if(b==
2)N.insertBefore(M.cloneNode(true),N.firstChild);else{M.parentNode.removeChild(M);b==1&&N.insertBefore(M,N.firstChild)}M=R}if(Q)N=Q}if(b==2){J=this.startContainer[0];if(J.nodeType==e.NODE_TEXT&&J.nextSibling&&J.nextSibling.nodeType==e.NODE_TEXT){J.data+=J.nextSibling.data;J.parentNode.removeChild(J.nextSibling)}J=this.endContainer[0];if(J.nodeType==e.NODE_TEXT&&J.nextSibling&&J.nextSibling.nodeType==e.NODE_TEXT){J.data+=J.nextSibling.data;J.parentNode.removeChild(J.nextSibling)}}else{if(G&&J&&(n[0].parentNode!=
G[0].parentNode||A[0].parentNode!=J[0].parentNode)){b=J._4e_index();I&&J[0].parentNode==n[0].parentNode&&b--;this.setStart(J.parent(),b)}this.collapse(true)}I&&n.remove();y&&A[0].parentNode&&A.remove()},collapse:function(b){if(b){this.endContainer=this.startContainer;this.endOffset=this.startOffset}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset}this.collapsed=true},clone:function(){var b=new q(this.document);b.startContainer=this.startContainer;b.startOffset=this.startOffset;
b.endContainer=this.endContainer;b.endOffset=this.endOffset;b.collapsed=this.collapsed;return b},getEnclosedNode:function(){var b=this.clone();b.optimize();if(b.startContainer[0].nodeType!=e.NODE_ELEMENT||b.endContainer[0].nodeType!=e.NODE_ELEMENT)return null;b=b.startContainer[0].childNodes[b.startOffset];for(var d=t(true,undefined),n=p(true),A=function(x){return n(x)&&d(x)};b&&A(b);)b=(new c(b))._4e_nextSourceNode()[0];return new c(b)},shrink:function(b,d){if(!this.collapsed){b=b||g.SHRINK_TEXT;
var n=this.clone(),A=this.startContainer,x=this.endContainer,C=this.startOffset,I=this.endOffset,y=1,D=1;if(A&&A[0].nodeType==e.NODE_TEXT)if(C)if(C>=A[0].nodeValue.length)n.setStartAfter(A);else{n.setStartBefore(A);y=0}else n.setStartBefore(A);if(x&&x[0].nodeType==e.NODE_TEXT)if(I)if(I>=x[0].nodeValue.length)n.setEndAfter(x);else{n.setEndAfter(x);D=0}else n.setEndBefore(x);n=new l(n);n.evaluator=function(J){J=J[0]||J;return J.nodeType==(b==g.SHRINK_ELEMENT?e.NODE_ELEMENT:e.NODE_TEXT)};var G;n.guard=
function(J,N){J=J[0]||J;if(b==g.SHRINK_ELEMENT&&J.nodeType==e.NODE_TEXT)return false;if(N&&J==G)return false;if(!N&&J.nodeType==e.NODE_ELEMENT)G=J;return true};if(y)(A=n[b==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(A,d?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);if(D){n.reset();(n=n[b==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(n,d?g.POSITION_BEFORE_END:g.POSITION_AFTER_END)}return!!(y||D)}},getTouchedStartNode:function(){var b=this.startContainer;if(this.collapsed||
b[0].nodeType!=e.NODE_ELEMENT)return b;return b.childNodes[this.startOffset]||b},createBookmark2:function(b){var d=this.startContainer,n=this.endContainer,A=this.startOffset,x=this.endOffset,C,I;if(!d||!n)return{start:0,end:0};if(b){if(d[0].nodeType==e.NODE_ELEMENT)if((C=new c(d[0].childNodes[A]))&&C[0]&&C[0].nodeType==e.NODE_TEXT&&A>0&&C[0].previousSibling.nodeType==e.NODE_TEXT){d=C;A=0}for(;d[0].nodeType==e.NODE_TEXT&&(I=d._4e_previous())&&I[0].nodeType==e.NODE_TEXT;){d=I;A+=I[0].nodeValue.length}if(!this.collapsed){if(n[0].nodeType==
e.NODE_ELEMENT)if((C=new c(n[0].childNodes[x]))&&C[0]&&C[0].nodeType==e.NODE_TEXT&&x>0&&C[0].previousSibling.nodeType==e.NODE_TEXT){n=C;x=0}for(;n[0].nodeType==e.NODE_TEXT&&(I=n._4e_previous())&&I[0].nodeType==e.NODE_TEXT;){n=I;x+=I[0].nodeValue.length}}}return{start:d._4e_address(b),end:this.collapsed?null:n._4e_address(b),startOffset:A,endOffset:x,normalized:b,is2:true}},createBookmark:function(b){var d,n,A,x;d=new c("<span></span>",null,this.document);d.attr("_ke_bookmark",1);d.css("display","none");
d.html("&nbsp;");if(b){A=u.guid("ke_bm_");d.attr("id",A+"S")}if(!this.collapsed){n=d._4e_clone();n.html("&nbsp;");b&&n.attr("id",A+"E");x=this.clone();x.collapse();x.insertNode(n)}x=this.clone();x.collapse(true);x.insertNode(d);if(n){this.setStartAfter(d);this.setEndBefore(n)}else this.moveToPosition(d,g.POSITION_AFTER_END);return{startNode:b?A+"S":d,endNode:b?A+"E":n,serializable:b}},moveToPosition:function(b,d){this.setStartAt(b,d);this.collapse(true)},trim:function(b,d){var n=this.startContainer,
A=this.startOffset,x=this.collapsed;if((!b||x)&&n[0]&&n[0].nodeType==e.NODE_TEXT){if(A)if(A>=n[0].nodeValue.length){A=n._4e_index()+1;n=n.parent()}else{b=n._4e_splitText(A);A=n._4e_index()+1;n=n.parent();if(v._4e_equals(this.startContainer,this.endContainer))this.setEnd(b,this.endOffset-this.startOffset);else if(v._4e_equals(n,this.endContainer))this.endOffset+=1}else{A=n._4e_index();n=n.parent()}this.setStart(n,A);if(x){this.collapse(true);return}}n=this.endContainer;A=this.endOffset;if(!(d||x)&&
n[0]&&n[0].nodeType==e.NODE_TEXT){if(A){A>=n.nodeValue.length||n._4e_splitText(A);A=n._4e_index()+1}else A=n._4e_index();n=n.parent();this.setEnd(n,A)}},insertNode:function(b){this.optimizeBookmark();this.trim(false,true);var d=this.startContainer,n=d[0].childNodes[this.startOffset];this.optimizeBookmark();this.trim(false,true);n?v.insertBefore(b[0]||b,n):d[0].appendChild(b[0]||b);v._4e_equals(b.parent(),this.endContainer)&&this.endOffset++;this.setStartBefore(b)},moveToBookmark:function(b){if(b.is2){var d=
k(this.document,b.start,b.normalized),n=b.startOffset,A=b.end&&k(this.document,b.end,b.normalized);b=b.endOffset;this.setStart(d,n);A?this.setEnd(A,b):this.collapse(true)}else{d=(n=b.serializable)?u.one("#"+b.startNode,this.document):b.startNode;b=n?u.one("#"+b.endNode,this.document):b.endNode;this.setStartBefore(d);d.remove();if(b&&b[0]){this.setEndBefore(b);b.remove()}else this.collapse(true)}},getCommonAncestor:function(b,d){var n=this.startContainer,A=this.endContainer;b=v._4e_equals(n,A)?b&&
n[0].nodeType==e.NODE_ELEMENT&&this.startOffset==this.endOffset-1?new c(n[0].childNodes[this.startOffset]):n:n._4e_commonAncestor(A);return d&&b[0].nodeType==e.NODE_TEXT?b.parent():b},enlarge:function(b){switch(b){case g.ENLARGE_ELEMENT:if(this.collapsed)return;b=this.getCommonAncestor();var d=new c(this.document.body),n,A,x,C,I,y=false,D,G;D=this.startContainer;G=this.startOffset;if(D[0].nodeType==e.NODE_TEXT){if(G){D=!u.trim(D[0].nodeValue.substring(0,G)).length&&D;y=!!D}if(D)if(!(C=D[0].previousSibling))x=
D.parent()}else{if(G)C=D[0].childNodes[G-1]||D[0].lastChild;C||(x=D)}for(;x||C;){if(x&&!C){if(!I&&v._4e_equals(x,b))I=true;if(!d._4e_contains(x))break;if(!y||x.css("display")!="inline"){y=false;if(I)n=x;else this.setStartBefore(x)}C=x[0].previousSibling}for(;C;){D=false;if(C.nodeType==e.NODE_TEXT){G=C.nodeValue;if(/[^\s\ufeff]/.test(G))C=null;D=/[\s\ufeff]$/.test(G)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(y&&o.$removeEmpty[C.nodeName.toLowerCase()]){G=v.text(C);if(/[^\s\ufeff]/.test(G))C=
null;else for(var J=C.all||C.getElementsByTagName("*"),N=0,M;M=J[N++];)if(!o.$removeEmpty[M.nodeName.toLowerCase()]){C=null;break}if(C)D=!!G.length}else C=null;if(D)if(y)if(I)n=x;else x&&this.setStartBefore(x);else y=true;if(C){D=C.previousSibling;if(!x&&!D){x=new c(C);C=null;break}C=D}else x=null}if(x)x=x.parent()}D=this.endContainer;G=this.endOffset;x=C=null;I=y=false;if(D[0].nodeType==e.NODE_TEXT){D=!u.trim(D[0].nodeValue.substring(G)).length&&D;y=!(D&&D[0].nodeValue.length);if(D)if(!(C=D[0].nextSibling))x=
D.parent()}else(C=D[0].childNodes[G])||(x=D);for(;x||C;){if(x&&!C){if(!I&&v._4e_equals(x,b))I=true;if(!d._4e_contains(x))break;if(!y||x.css("display")!="inline"){y=false;if(I)A=x;else x&&this.setEndAfter(x)}C=x[0].nextSibling}for(;C;){D=false;if(C.nodeType==e.NODE_TEXT){G=C.nodeValue;if(/[^\s\ufeff]/.test(G))C=null;D=/^[\s\ufeff]/.test(G)}else if(C.offsetWidth>0&&!C.getAttribute("_ke_bookmark"))if(y&&o.$removeEmpty[C.nodeName.toLowerCase()]){G=v.text(C);if(/[^\s\ufeff]/.test(G))C=null;else{J=C.all||
C.getElementsByTagName("*");for(N=0;M=J[N++];)if(!o.$removeEmpty[M.nodeName.toLowerCase()]){C=null;break}}if(C)D=!!G.length}else C=null;if(D)if(y)if(I)A=x;else this.setEndAfter(x);if(C){D=C.nextSibling;if(!x&&!D){x=new c(C);C=null;break}C=D}else x=null}if(x)x=x.parent()}if(n&&A){b=n._4e_contains(A)?A:n;this.setStartBefore(b);this.setEndAfter(b)}break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:x=new q(this.document);d=new c(this.document.body);x.setStartAt(d,g.POSITION_AFTER_START);
x.setEnd(this.startContainer,this.startOffset);x=new l(x);var Q,R,W=l.blockBoundary(b==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),$=function(aa){var E=W(aa);E||(Q=aa);return E};n=function(aa){var E=$(aa);if(!E&&aa[0]&&aa._4e_name()=="br")R=aa;return E};x.guard=$;x=x.lastBackward();Q=Q||d;this.setStartAt(Q,Q._4e_name()!="br"&&(!x&&this.checkStartOfBlock()||x&&Q._4e_contains(x))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);x=this.clone();x.collapse();x.setEndAt(d,g.POSITION_BEFORE_END);x=new l(x);x.guard=
b==g.ENLARGE_LIST_ITEM_CONTENTS?n:$;Q=null;x=x.lastForward();Q=Q||d;this.setEndAt(Q,!x&&this.checkEndOfBlock()||x&&Q._4e_contains(x)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);R&&this.setEndAfter(R)}},checkStartOfBlock:function(){var b=this.startContainer,d=this.startOffset;if(d&&b[0].nodeType==e.NODE_TEXT)if(u.trim(b[0].nodeValue.substring(0,d)).length)return false;this.trim();b=new a(this.startContainer);d=this.clone();d.collapse(true);d.setStartAt(b.block||b.blockLimit,g.POSITION_AFTER_START);
b=new l(d);b.evaluator=w(true);return b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,d=this.endOffset;if(b[0].nodeType==e.NODE_TEXT)if(u.trim(b[0].nodeValue.substring(d)).length)return false;this.trim();b=new a(this.endContainer);d=this.clone();d.collapse(false);d.setEndAt(b.block||b.blockLimit,g.POSITION_BEFORE_END);b=new l(d);b.evaluator=w(false);return b.checkForward()},deleteContents:function(){this.collapsed||this.execContentsAction(0)},extractContents:function(){var b=
this.document.createDocumentFragment();this.collapsed||this.execContentsAction(1,b);return b},checkBoundaryOfElement:function(b,d){var n=this.clone();n[d==g.START?"setStartAt":"setEndAt"](b,d==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);b=new l(n);b.evaluator=B;return b[d==g.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var b=this.startContainer,d=this.endContainer,n=this.startOffset,A=this.endOffset,x;if(b[0].nodeType==e.NODE_ELEMENT){x=b[0].childNodes.length;if(x>
n)b=new c(b[0].childNodes[n]);else if(x<1)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=new c(b);b=b._4e_nextSourceNode()||b}}if(d[0].nodeType==e.NODE_ELEMENT){x=d[0].childNodes.length;if(x>A)d=(new c(d[0].childNodes[A]))._4e_previousSourceNode(true);else if(x<1)d=d._4e_previousSourceNode();else{for(d=d[0];d.lastChild;)d=d.lastChild;d=new c(d)}}if(b._4e_position(d)&i.POSITION_FOLLOWING)b=d;return{startNode:b,endNode:d}},fixBlock:function(b,d){var n=this.createBookmark();
d=new c(this.document.createElement(d));this.collapse(b);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);d[0].appendChild(this.extractContents());d._4e_trim();m.ie||d._4e_appendBogus();this.insertNode(d);this.moveToBookmark(n);return d},splitBlock:function(b){var d=new a(this.startContainer),n=new a(this.endContainer),A=d.block,x=n.block,C=null;if(d.blockLimit[0]!==n.blockLimit[0])return null;if(b!="br"){if(!A){A=this.fixBlock(true,b);x=(new a(this.endContainer)).block}x||(x=this.fixBlock(false,b))}b=A&&this.checkStartOfBlock();
d=x&&this.checkEndOfBlock();this.deleteContents();if(A&&v._4e_equals(A,x))if(d){C=new a(this.startContainer);this.moveToPosition(x,g.POSITION_AFTER_END);x=null}else if(b){C=new a(this.startContainer);this.moveToPosition(A,g.POSITION_BEFORE_START);A=null}else{x=this.splitElement(A);!m.ie&&!u.inArray(A._4e_name(),["ul","ol"])&&A._4e_appendBogus()}return{previousBlock:A,nextBlock:x,wasStartOfBlock:b,wasEndOfBlock:d,elementPath:C}},splitElement:function(b){if(!this.collapsed)return null;this.setEndAt(b,
g.POSITION_BEFORE_END);var d=this.extractContents(),n=b._4e_clone(false);n[0].appendChild(d);n.insertAfter(b);this.moveToPosition(b,g.POSITION_AFTER_END);return n},moveToElementEditablePosition:function(b,d){var n,A=z.XHTML_DTD;if(A.$empty[b._4e_name()])return false;for(;b&&b[0].nodeType==e.NODE_ELEMENT;){if(n=b._4e_isEditable())this.moveToPosition(b,d?g.POSITION_BEFORE_END:g.POSITION_AFTER_START);else if(A.$inline[b._4e_name()]){this.moveToPosition(b,d?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);
return true}if((b=A.$empty[b._4e_name()]?b[d?"_4e_previous":"_4e_next"](s):b[d?"_4e_last":"_4e_first"](s))&&b[0].nodeType==e.NODE_TEXT){this.moveToPosition(b,d?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);return true}}return n},selectNodeContents:function(b){this.setStart(b,0);this.setEnd(b,b[0].nodeType==e.NODE_TEXT?b[0].nodeValue.length:b[0].childNodes.length)}});var f={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,
strong:1,sub:1,sup:1,tt:1,u:1,"var":1},h=new l.whitespaces,r=new l.bookmark;z.Range=q});
KISSY.Editor.add("domiterator",function(z){function q(k){if(!(arguments.length<1)){this.range=k;this.forceBrBreak=false;this.enlargeBr=true;this.enforceRealBlocks=false;this._||(this._={})}}var B=KISSY,s=B.UA,w=z.Walker,t=z.Range,p=z.RANGE,u=z.NODE,e=z.ElementPath,g=B.Node,i=B.DOM,l=/^[\r\n\t ]*$/,v=w.bookmark();B.augment(q,{getNextParagraph:function(k){var m,o,a,c,j;if(!this._.lastNode){o=this.range.clone();o.enlarge(this.forceBrBreak||!this.enlargeBr?p.ENLARGE_LIST_ITEM_CONTENTS:p.ENLARGE_BLOCK_CONTENTS);
var f=new w(o),h=w.bookmark(true,true);f.evaluator=h;this._.nextNode=f.next();f=new w(o);f.evaluator=h;f=f.previous();this._.lastNode=f._4e_nextSourceNode(true);if(this._.lastNode&&this._.lastNode[0].nodeType==u.NODE_TEXT&&!B.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()){h=new t(o.document);h.moveToPosition(this._.lastNode,p.POSITION_AFTER_END);if(h.checkEndOfBlock()){h=new e(h.endContainer);this._.lastNode=(h.block||h.blockLimit)._4e_nextSourceNode(true)}}if(!this._.lastNode){this._.lastNode=
this._.docEndMarker=new g(o.document.createTextNode(""));i.insertAfter(this._.lastNode[0],f[0])}o=null}h=this._.nextNode;f=this._.lastNode;for(this._.nextNode=null;h;){var r=false,b=h[0].nodeType!=u.NODE_ELEMENT,d=false;if(b){if(h[0].nodeType==u.NODE_TEXT)if(l.test(h[0].nodeValue))b=false}else{var n=h._4e_name();if(h._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if(n=="br")b=true;else if(!o&&!h[0].childNodes.length&&n!="hr"){m=h;a=h._4e_equals(f);break}if(o){o.setEndAt(h,p.POSITION_BEFORE_START);
if(n!="br")this._.nextNode=h}r=true}else{if(h[0].firstChild){if(!o){o=new t(this.range.document);o.setStartAt(h,p.POSITION_BEFORE_START)}h=new g(h[0].firstChild);continue}b=true}}if(b&&!o){o=new t(this.range.document);o.setStartAt(h,p.POSITION_BEFORE_START)}a=(!r||b)&&h._4e_equals(f);if(o&&!r)for(;!h[0].nextSibling&&!a;){n=h.parent();if(n._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){r=true;a||n._4e_equals(f);break}h=n;b=true;a=h._4e_equals(f);d=true}b&&o.setEndAt(h,p.POSITION_AFTER_END);h=h._4e_nextSourceNode(d,
null,f);a=!h;if((r||a)&&o){b=o.getBoundaryNodes();r=new e(o.startContainer);if(b.startNode.parent()._4e_equals(r.blockLimit)&&v(b.startNode)&&v(b.endNode)){o=null;this._.nextNode=null}else break}if(a)break}if(!m){if(!o){this._.docEndMarker&&this._.docEndMarker.remove();return this._.nextNode=null}r=new e(o.startContainer);h=r.blockLimit;b={div:1,th:1,td:1};m=r.block;if((!m||!m[0])&&!this.enforceRealBlocks&&b[h._4e_name()]&&o.checkStartOfBlock()&&o.checkEndOfBlock())m=h;else if(!m||this.enforceRealBlocks&&
m._4e_name()=="li"){m=new g(this.range.document.createElement(k||"p"));m[0].appendChild(o.extractContents());m._4e_trim();o.insertNode(m);c=j=true}else if(m._4e_name()!="li"){if(!o.checkStartOfBlock()||!o.checkEndOfBlock()){m=m._4e_clone(false);m[0].appendChild(o.extractContents());m._4e_trim();j=o.splitBlock();c=!j.wasStartOfBlock;j=!j.wasEndOfBlock;o.insertNode(m)}}else if(!a)this._.nextNode=m._4e_equals(f)?null:o.getBoundaryNodes().endNode._4e_nextSourceNode(true,null,f)}if(c){o=new g(m[0].previousSibling);
if(o[0]&&o[0].nodeType==u.NODE_ELEMENT)if(o._4e_name()=="br")o._4e_remove();else o[0].lastChild&&o[0].lastChild.nodeName.toLowerCase()=="br"&&i._4e_remove(o[0].lastChild)}if(j){o=w.bookmark(false,true);c=new g(m[0].lastChild);if(c[0]&&c[0].nodeType==u.NODE_ELEMENT&&c._4e_name()=="br")if(s.ie||c._4e_previous(o)||c._4e_next(o))c._4e_remove()}if(!this._.nextNode)this._.nextNode=a||m._4e_equals(f)?null:m._4e_nextSourceNode(true,null,f);return m}});t.prototype.createIterator=function(){return new q(this)}});
KISSY.Editor.add("selection",function(z){function q(f){this.document=f;this._={cache:{}};if(t.ie){var h=this.getNative().createRange();if(!h||h.item&&h.item(0).ownerDocument!=f||h.parentElement&&h.parentElement().ownerDocument!=f)this.isInvalid=true}}function B(f){f=new q(f);return!f||f.isInvalid?null:f}function s(f){var h=f.document,r=new g(h.body),b=new g(h.documentElement);if(t.ie){if(t.ie<8||document.documentMode==7)b.on("click",function(C){p._4e_name(C.target)==="html"&&f.getSelection().getRanges()[0].select()});
var d,n;r.on("focusin",function(C){if(C.target.nodeName.toUpperCase()=="BODY")if(d){try{d.select()}catch(I){}d=null}});r.on("focus",function(){n=true;x()});r.on("beforedeactivate",function(C){C.relatedTarget||(n=false)});t.ie<8&&u.on(p._4e_getWin(h),"blur",function(){h.selection.empty()});r.on("mousedown",A);r.on("mouseup",function(){n=true;setTimeout(function(){x(true)},0)});r.on("keydown",A);r.on("keyup",function(){n=true;x()});u.on(h,"selectionchange",x);var A=function(){n=false},x=function(C){if(n){var I=
f.document,y=f.getSelection(),D=y&&y.getNative();if(C&&D&&D.type=="None")if(!I.queryCommandEnabled("InsertImage")){setTimeout(function(){x(true)},50);return}var G;if(!(D&&D.type=="Text"&&(G=D.createRange().parentElement().nodeName.toLowerCase())&&G in{input:1,textarea:1})){d=D&&y.getRanges()[0];f._monitor()}}}}else{u.on(h,"mouseup",f._monitor,f);u.on(h,"keyup",f._monitor,f)}}z.SELECTION={};var w=KISSY,t=w.UA,p=w.DOM,u=w.Event,e=z.Utils.tryThese,g=w.Node,i=z.SELECTION,l=z.RANGE,v=z.NODE,k=z.Walker,
m=z.Range;i.SELECTION_NONE=1;i.SELECTION_TEXT=2;i.SELECTION_ELEMENT=3;var o={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};w.augment(q,{getNative:t.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=p._4e_getWin(this.document).getSelection())},getType:t.ie?function(){var f=this._.cache;if(f.type)return f.type;
var h=i.SELECTION_NONE;try{var r=this.getNative(),b=r.type;if(b=="Text")h=i.SELECTION_TEXT;if(b=="Control")h=i.SELECTION_ELEMENT;if(r.createRange().parentElement)h=i.SELECTION_TEXT}catch(d){}return f.type=h}:function(){var f=this._.cache;if(f.type)return f.type;var h=i.SELECTION_TEXT,r=this.getNative();if(r){if(r.rangeCount==1){r=r.getRangeAt(0);var b=r.startContainer;if(b==r.endContainer&&b.nodeType==v.NODE_ELEMENT&&r.endOffset-r.startOffset===1&&o[b.childNodes[r.startOffset].nodeName.toLowerCase()])h=
i.SELECTION_ELEMENT}}else h=i.SELECTION_NONE;return f.type=h},getRanges:t.ie?function(){var f=function(h,r){h=h.duplicate();h.collapse(r);r=h.parentElement();for(var b=r.childNodes,d,n=0;n<b.length;n++){var A=b[n];if(A.nodeType==v.NODE_ELEMENT){d=h.duplicate();d.moveToElementText(A);A=d.compareEndPoints("StartToStart",h);var x=d.compareEndPoints("EndToStart",h);d.collapse();if(A>0)break;else if(!A||x==1&&A==-1)return{container:r,offset:n};else if(!x)return{container:r,offset:n+1};d=null}}if(!d){d=
h.duplicate();d.moveToElementText(r);d.collapse(false)}d.setEndPoint("StartToStart",h);h=d.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;h>0;)h-=b[--n].nodeValue.length}catch(C){h=0}return h===0?{container:r,offset:n}:{container:b[n],offset:-h}};return function(){var h=this._.cache;if(h.ranges)return h.ranges;var r=this.getNative(),b=r&&r.createRange(),d=this.getType();if(!r)return[];if(d==i.SELECTION_TEXT){r=new m(this.document);d=f(b,true);r.setStart(new g(d.container),d.offset);d=f(b);r.setEnd(new g(d.container),
d.offset);return h.ranges=[r]}else if(d==i.SELECTION_ELEMENT){h=this._.cache.ranges=[];for(d=0;d<b.length;d++){var n=b.item(d),A=n.parentNode,x=0;for(r=new m(this.document);x<A.childNodes.length&&A.childNodes[x]!=n;x++);r.setStart(new g(A),x);r.setEnd(new g(A),x+1);h.push(r)}return h}return h.ranges=[]}}():function(){var f=this._.cache;if(f.ranges)return f.ranges;var h=[],r=this.getNative();if(!r)return[];for(var b=0;b<r.rangeCount;b++){var d=r.getRangeAt(b),n=new m(this.document);n.setStart(new g(d.startContainer),
d.startOffset);n.setEnd(new g(d.endContainer),d.endOffset);h.push(n)}return f.ranges=h},getStartElement:function(){var f=this._.cache;if(f.startElement!==undefined)return f.startElement;var h,r=this.getNative();switch(this.getType()){case i.SELECTION_ELEMENT:return this.getSelectedElement();case i.SELECTION_TEXT:var b=this.getRanges()[0];if(b)if(!b.collapsed){for(b.optimize();;){h=b.startContainer;if(b.startOffset==(h[0].childNodes?h[0].childNodes.length:h[0].nodeValue.length)&&!h._4e_isBlockBoundary())b.setStartAfter(h);
else break}h=b.startContainer;if(h[0].nodeType!=v.NODE_ELEMENT)return h.parent();h=new g(h[0].childNodes[b.startOffset]);if(!h[0]||h[0].nodeType!=v.NODE_ELEMENT)return b.startContainer;for(b=h[0].firstChild;b&&b.nodeType==v.NODE_ELEMENT;){h=new g(b);b=b.firstChild}return h}if(t.ie){b=r.createRange();b.collapse(true);h=b.parentElement()}else if((h=r.anchorNode)&&h.nodeType!=v.NODE_ELEMENT)h=h.parentNode}return f.startElement=h?new g(h):null},getSelectedElement:function(){var f=this._.cache;if(f.selectedElement!==
undefined)return f.selectedElement;var h=this,r=e(function(){return h.getNative().createRange().item(0)},function(){for(var b=h.getRanges()[0],d,n,A=2;A&&!((d=b.getEnclosedNode())&&d[0].nodeType==v.NODE_ELEMENT&&o[d._4e_name()]&&(n=d));A--)b.shrink(l.SHRINK_ELEMENT);return n[0]});return f.selectedElement=r?new g(r):null},reset:function(){this._.cache={}},selectElement:function(f){var h;if(t.ie){this.getNative().empty();try{h=this.document.body.createControlRange();h.addElement(f[0]);h.select()}catch(r){h=
this.document.body.createTextRange();h.moveToElementText(f[0]);h.select()}finally{}}else{h=this.document.createRange();h.selectNode(f[0]);f=this.getNative();f.removeAllRanges();f.addRange(h)}this.reset()},selectRanges:function(f){if(t.ie)f[0]&&f[0].select();else{var h=this.getNative();if(!h)return;h.removeAllRanges();for(var r=0;r<f.length;r++){var b=f[r],d=this.document.createRange(),n=b.startContainer;b.collapsed&&t.gecko&&t.gecko<1.09&&n[0].nodeType==v.NODE_ELEMENT&&!n[0].childNodes.length&&n[0].appendChild(this.document.createTextNode(""));
d.setStart(n[0],b.startOffset);d.setEnd(b.endContainer[0],b.endOffset);h.addRange(d)}}this.reset()},createBookmarks2:function(f){for(var h=[],r=this.getRanges(),b=0;b<r.length;b++)h.push(r[b].createBookmark2(f));return h},createBookmarks:function(f){for(var h=[],r=this.getRanges(),b=r.length,d,n=0;n<b;n++){h.push(d=r[n].createBookmark(f,true));var A=(f=d.serializable)?w.one("#"+d.startNode):d.startNode;d=f?w.one("#"+d.endNode):d.endNode;for(var x=n+1;x<b;x++){var C=r[x],I=C.startContainer,y=C.endContainer;
p._4e_equals(I,A.parent())&&C.startOffset++;p._4e_equals(I,d.parent())&&C.startOffset++;p._4e_equals(y,A.parent())&&C.endOffset++;p._4e_equals(y,d.parent())&&C.endOffset++}}return h},selectBookmarks:function(f){for(var h=[],r=0;r<f.length;r++){var b=new m(this.document);b.moveToBookmark(f[r]);h.push(b)}this.selectRanges(h);return this},getCommonAncestor:function(){var f=this.getRanges();return f[0].startContainer._4e_commonAncestor(f[f.length-1].endContainer)},scrollIntoView:function(){this.getStartElement().scrollIntoView()}});
z.Selection=q;var a={table:1,tbody:1,tr:1},c=k.whitespaces(true),j=/\ufeff|\u00a0/;m.prototype.select=t.ie?function(f){var h=this.collapsed,r,b;if(this.startContainer[0].nodeType==v.NODE_ELEMENT&&this.startContainer._4e_name()in a||this.endContainer[0].nodeType==v.NODE_ELEMENT&&this.endContainer._4e_name()in a)this.shrink(v.NODE_ELEMENT,true);var d=this.createBookmark(),n=d.startNode,A;if(!h)A=d.endNode;d=this.document.body.createTextRange();d.moveToElementText(n[0]);d.moveStart("character",1);if(A){f=
this.document.body.createTextRange();f.moveToElementText(A[0]);d.setEndPoint("EndToEnd",f);d.moveEnd("character",-1)}else{for(r=n[0].nextSibling;r&&!c(r);)r=r.nextSibling;r=!(r&&r.nodeValue&&r.nodeValue.match(j))&&(f||!n[0].previousSibling||n[0].previousSibling&&p._4e_name(n[0].previousSibling)=="br");b=this.document.createElement("span");b.innerHTML="&#65279;";b=new g(b);p.insertBefore(b[0],n[0]);r&&p.insertBefore(this.document.createTextNode("\ufeff"),n[0])}this.setStartBefore(n);n._4e_remove();
if(h){if(r){d.moveStart("character",-1);d.select();this.document.selection.clear()}else d.select();if(b){this.moveToPosition(b,l.POSITION_BEFORE_START);b._4e_remove()}}else{this.setEndBefore(A);A.remove();d.select()}}:function(){var f=this.startContainer;this.collapsed&&f[0].nodeType==v.NODE_ELEMENT&&!f[0].childNodes.length&&f[0].appendChild(this.document.createTextNode(""));var h=this.document.createRange();h.setStart(f[0],this.startOffset);try{h.setEnd(this.endContainer[0],this.endOffset)}catch(r){if(r.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=
0){this.collapse(true);h.setEnd(this.endContainer[0],this.endOffset)}else throw r;}f=B(this.document).getNative();f.removeAllRanges();f.addRange(h)};z.on("instanceCreated",function(f){s(f.editor)})});
KISSY.Editor.add("styles",function(z){function q(E,F){for(var H in E)E[H]=E[H].replace(aa,function(K,L){return F[L]})}function B(E,F){if(F){E=A.clone(E);q(E.attributes,F);q(E.styles,F)}F=this.element=(E.element||"*").toLowerCase();this.type=F=="#"||R[F]?C.STYLE_BLOCK:W[F]?C.STYLE_OBJECT:C.STYLE_INLINE;this._={definition:E}}function s(E,F){F=F?this.removeFromRange:this.applyToRange;E.body.focus();E=new y(E);for(var H=E.getRanges(),K=0;K<H.length;K++)F.call(this,H[K]);E.selectRanges(H)}function w(E,
F){var H=E.element;if(H=="*")H="span";F=new N(F.createElement(H));return t(F,E)}function t(E,F){var H=F._.definition;F=H.attributes;H=B.getStyleText(H);if(F)for(var K in F)E.attr(K,F[K]);if(H)E[0].style.cssText=H;return E}function p(E){var F=E.createBookmark(true),H=E.createIterator();H.enforceRealBlocks=true;H.enlargeBr=true;for(var K,L=E.document;K=H.getNextParagraph();){var O=w(this,L);i(K,O)}E.moveToBookmark(F)}function u(E,F,H){var K="",L="";E=E.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,
function(O,P,S){P&&(K=P);S&&(L=S);return""});return K+E.replace(F,H)+L}function e(E,F){var H=E.html();H=u(H,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");H=H.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");H=H.replace(/([ \t\n\r]+|&nbsp;)/g," ");H=H.replace(/<br\b[^>]*>/gi,"\n");if(M.ie){E=E[0].ownerDocument.createElement("div");E.appendChild(F[0]);F[0].outerHTML="<pre>"+H+"</pre>";F=new N(E.firstChild);F.remove()}else F.html(H);return F}function g(E){var F=[];u(E._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,
function(H,K,L){return K+"</pre>"+L+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(H,K){F.push(K)});return F}function i(E,F){var H=F._4e_name=="pre",K=E._4e_name=="pre",L=!H&&K;if(H&&!K)F=e(E,F);else if(L)F=v(g(E),F);else E._4e_moveChildren(F);E[0].parentNode.replaceChild(F[0],E[0]);H&&l(F)}function l(E){var F;if((F=E._4e_previousSourceNode(true,D.NODE_ELEMENT))&&F._4e_name()=="pre"){var H=u(F.html(),/\n$/,"")+"\n\n"+u(E.html(),/^\n/,"");if(M.ie)E[0].outerHTML="<pre>"+H+"</pre>";else E.html(H);
F.remove()}}function v(E,F){for(var H=F[0].ownerDocument.createDocumentFragment(),K=0;K<E.length;K++){var L=E[K];L=L.replace(/(\r\n|\r)/g,"\n");L=u(L,/^[ \t]*\n/,"");L=u(L,/\n$/,"");L=u(L,/^[ \t]+|[ \t]+$/g,function(P,S){return P.length==1?"&nbsp;":S?" "+(new Array(P.length)).join("&nbsp;"):(new Array(P.length)).join("&nbsp;")+" "});L=L.replace(/\n/g,"<br>");L=L.replace(/[ \t]{2,}/g,function(P){return(new Array(P.length)).join("&nbsp;")+" "});var O=F._4e_clone();O.html(L);H.appendChild(O[0])}return H}
function k(E){var F=E.document;if(E.collapsed){F=w(this,F);E.insertNode(F);E.moveToPosition(F,I.POSITION_BEFORE_END)}else{var H=this.element,K=this._.definition,L,O=z.XHTML_DTD[H]||(L=true,z.XHTML_DTD.span),P=E.createBookmark();E.enlarge(I.ENLARGE_ELEMENT);E.trim();var S=E.createBookmark(),da=S.startNode;S=S.endNode;for(var U=da,X;U&&U[0];){var T=false;if(x._4e_equals(U,S)){U=null;T=true}else{var V=U[0].nodeType,ba=V==D.NODE_ELEMENT?U._4e_name():null;if(ba&&U.attr("_ke_bookmark")){U=U._4e_nextSourceNode(true);
continue}if(!ba||O[ba]&&(U._4e_position(S)|G.POSITION_PRECEDING|G.POSITION_IDENTICAL|G.POSITION_IS_CONTAINED)==G.POSITION_PRECEDING+G.POSITION_IDENTICAL+G.POSITION_IS_CONTAINED&&(!K.childRule||K.childRule(U))){var ca=U.parent();if(ca&&ca[0]&&((z.XHTML_DTD[ca._4e_name()]||z.XHTML_DTD.span)[H]||L)&&(!K.parentRule||K.parentRule(ca))){if(!X&&(!ba||!z.XHTML_DTD.$removeEmpty[ba]||(U._4e_position(S)|G.POSITION_PRECEDING|G.POSITION_IDENTICAL|G.POSITION_IS_CONTAINED)==G.POSITION_PRECEDING+G.POSITION_IDENTICAL+
G.POSITION_IS_CONTAINED)){X=new J(F);X.setStartBefore(U)}if(V==D.NODE_TEXT||V==D.NODE_ELEMENT&&!U[0].childNodes.length){V=U;for(var Y;!V[0].nextSibling&&(Y=V.parent(),O[Y._4e_name()])&&(Y._4e_position(da)|G.POSITION_FOLLOWING|G.POSITION_IDENTICAL|G.POSITION_IS_CONTAINED)==G.POSITION_FOLLOWING+G.POSITION_IDENTICAL+G.POSITION_IS_CONTAINED&&(!K.childRule||K.childRule(Y));)V=Y;X.setEndAfter(V);V[0].nextSibling||(T=true)}}else T=true}else T=true;U=U._4e_nextSourceNode()}if(T&&X&&!X.collapsed){T=w(this,
F);for(V=X.getCommonAncestor();T&&V&&T[0]&&V[0];){if(V._4e_name()==H){for(var Z in K.attributes)T.attr(Z)==V.attr(Z)&&T[0].removeAttribute(Z);for(var ea in K.styles)T._4e_style(ea)==V._4e_style(ea)&&T._4e_style(ea,"");if(!T._4e_hasAttributes()){T=null;break}}V=V.parent()}if(T){T[0].appendChild(X.extractContents());b(this,T);X.insertNode(T);T._4e_mergeSiblings();M.ie||T[0].normalize()}X=null}}da.remove();S.remove();E.moveToBookmark(P);E.shrink(I.SHRINK_TEXT)}}function m(E){E.enlarge(I.ENLARGE_ELEMENT);
var F=E.createBookmark(),H=F.startNode;if(E.collapsed){for(var K=new Q(H.parent()),L,O=0,P;O<K.elements.length&&(P=K.elements[O]);O++){if(P==K.block||P==K.blockLimit)break;if(this.checkElementRemovable(P)){var S=E.checkBoundaryOfElement(P,I.END),da=!S&&E.checkBoundaryOfElement(P,I.START);if(da||S){L=P;L.match=da?"start":"end"}else{P._4e_mergeSiblings();h(this,P)}}}if(L&&L[0]){P=H;for(O=0;;O++){S=K.elements[O];if(x._4e_equals(S,L))break;else if(S.match)continue;else S=S._4e_clone();S[0].appendChild(P[0]);
P=S}x[L.match=="start"?"insertBefore":"insertAfter"](P[0],L[0])}}else{var U=F.endNode,X=this;K=function(){for(var T=new Q(H.parent()),V=new Q(U.parent()),ba=null,ca=null,Y=0;Y<T.elements.length;Y++){var Z=T.elements[Y];if(Z==T.block||Z==T.blockLimit)break;if(X.checkElementRemovable(Z))ba=Z}for(Y=0;Y<V.elements.length;Y++){Z=V.elements[Y];if(Z==V.block||Z==V.blockLimit)break;if(X.checkElementRemovable(Z))ca=Z}ca&&U._4e_breakParent(ca);ba&&H._4e_breakParent(ba)};K();for(L=new N(H[0].nextSibling);L[0]!==
U[0];){O=L._4e_nextSourceNode();if(L[0].nodeType==D.NODE_ELEMENT&&this.checkElementRemovable(L)){L._4e_name()==this.element?h(this,L):d(L,f(this)[L._4e_name()]);if(O[0].nodeType==D.NODE_ELEMENT&&O._4e_contains(H)){K();O=new N(H[0].nextSibling)}}L=O}}E.moveToBookmark(F)}function o(E){var F={};E.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(H,K,L){F[K]=L});return F}function a(E,F){typeof E=="string"&&(E=o(E));typeof F=="string"&&(F=o(F));for(var H in E)if(!(H in F&&
(F[H]==E[H]||E[H]=="inherit"||F[H]=="inherit")))return false;return true}function c(E,F){if(F!==false){F=document.createElement("span");F.style.cssText=E;E=F.style.cssText||""}else E=E;return E.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function j(E){var F=E._AC;if(F)return F;F={};var H=0,K=E.attributes;if(K)for(var L in K){H++;F[L]=K[L]}if(K=B.getStyleText(E)){F.style||H++;F.style=K}F._length=H;return E._AC=F}function f(E){if(E._.overrides)return E._.overrides;
var F=E._.overrides={},H=E._.definition.overrides;if(H){A.isArray(H)||(H=[H]);for(var K=0;K<H.length;K++){var L=H[K],O,P;if(typeof L=="string")O=L.toLowerCase();else{O=L.element?L.element.toLowerCase():E.element;P=L.attributes}L=F[O]||(F[O]={});if(P){L=L.attributes=L.attributes||[];for(var S in P)L.push([S.toLowerCase(),P[S]])}}}return F}function h(E,F){var H=E._.definition,K=A.mix(A.mix({},H.attributes),f(E)[F._4e_name()]);H=H.styles;var L=A.isEmptyObject(K)&&A.isEmptyObject(H);for(var O in K)if(!((O==
"class"||E._.definition.fullMatch)&&F.attr(O)!=r(O,K[O]))){L=L||!!F._4e_hasAttribute(O);F.removeAttr(O)}for(var P in H)if(!(E._.definition.fullMatch&&F._4e_style(P)!=r(P,H[P],true))){L=L||!!F._4e_style(P);F._4e_style(P,"")}L&&n(F)}function r(E,F,H){var K=new N("<span></span>");K[H?"_4e_style":"attr"](E,F);return K[H?"_4e_style":"attr"](E)}function b(E,F){for(var H=f(E),K=F.all(E.element),L=K.length;--L>=0;)h(E,new N(K[L]));for(var O in H)if(O!=E.element){K=F.all(O);for(L=K.length-1;L>=0;L--){var P=
new N(K[L]);d(P,H[O])}}}function d(E,F){if(F=F&&F.attributes)for(var H=0;H<F.length;H++){var K=F[H][0],L;if(L=E.attr(K)){var O=F[H][1];if(O===null||O.test&&O.test(L)||typeof O=="string"&&L==O)E[0].removeAttribute(K)}}n(E)}function n(E){if(!E._4e_hasAttributes()){var F=E[0].firstChild,H=E[0].lastChild;E._4e_remove(true);if(F){F.nodeType==D.NODE_ELEMENT&&x._4e_mergeSiblings(F);H&&!F===H&&H.nodeType==D.NODE_ELEMENT&&x._4e_mergeSiblings(H)}}}var A=KISSY,x=A.DOM,C=z.STYLE={},I=z.RANGE,y=z.Selection,D=
z.NODE,G=z.POSITION,J=z.Range,N=A.Node,M=A.UA,Q=z.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},W={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},$=/\s*(?:;\s*|$)/,aa=/#\((.+?)\)/g;C.STYLE_BLOCK=1;C.STYLE_INLINE=2;C.STYLE_OBJECT=3;B.prototype={apply:function(E){s.call(this,E,false)},remove:function(E){s.call(this,E,true)},applyToRange:function(E){return(this.applyToRange=this.type==C.STYLE_INLINE?k:this.type==C.STYLE_BLOCK?p:this.type==
C.STYLE_OBJECT?null:null).call(this,E)},removeFromRange:function(E){return(this.removeFromRange=this.type==C.STYLE_INLINE?m:null).call(this,E)},applyToObject:function(E){t(E,this)},checkElementRemovable:function(E,F){if(!E)return false;var H=this._.definition;if(E._4e_name()==this.element){if(!F&&!E._4e_hasAttributes())return true;H=j(H);if(H._length){for(var K in H)if(K!="_length"){var L=E.attr(K)||"";if(K=="style"?a(H[K],c(L,false)):H[K]==L){if(!F)return true}else if(F)return false}if(F)return true}else return true}if(H=
f(this)[E._4e_name()]){if(!(H=H.attributes))return true;for(F=0;F<H.length;F++){K=H[F][0];if(K=E.attr(K)){L=H[F][1];if(L===null||typeof L=="string"&&K==L||L.test(K))return true}}}return false},checkActive:function(E){switch(this.type){case C.STYLE_BLOCK:return this.checkElementRemovable(E.block||E.blockLimit,true);case C.STYLE_OBJECT:case C.STYLE_INLINE:for(var F=E.elements,H=0,K;H<F.length;H++){K=F[H];if(!(this.type==C.STYLE_INLINE&&(x._4e_equals(K,E.block)||x._4e_equals(K,E.blockLimit))))if(!(this.type==
C.STYLE_OBJECT&&!(K._4e_name()in W)))if(this.checkElementRemovable(K,true))return true}}return false}};B.getStyleText=function(E){var F=E._ST;if(F)return F;F=E.styles;var H=E.attributes&&E.attributes.style||"",K="";if(H.length)H=H.replace($,";");for(var L in F){var O=F[L],P=(L+":"+O).replace($,";");if(O=="inherit")K+=P;else H+=P}if(H.length)H=c(H);H+=K;return E._ST=H};z.Style=B});
KISSY.Editor.add("button",function(){function z(w){z.superclass.constructor.call(this,w);this._init()}var q=KISSY.Editor,B=KISSY,s=B.Node;z.ON="on";z.OFF="off";z.DISABLED="disabled";z.ON_CLASS="ke-triplebutton-on";z.OFF_CLASS="ke-triplebutton-off";z.DISABLED_CLASS="ke-triplebutton-disabled";z.ATTRS={state:{value:"off"},container:{},text:{},contentCls:{},cls:{}};B.extend(z,B.Base,{_init:function(){var w=this.get("container")[0]||this.get("container");this.el=new s("<a class='ke-triplebutton ke-triplebutton-off' href='#' role=\"button\"></a>");
this.el._4e_unselectable();this._attachCls();if(this.get("text"))this.el.html(this.get("text"));else if(this.get("contentCls")){this.el.html("<span class='ke-toolbar-item "+this.get("contentCls")+"'></span>");this.el.one("span")._4e_unselectable()}this.get("title")&&this.el.attr("title",this.get("title"));w.appendChild(this.el[0]);this.el.on("click",this._action,this);this.on("afterStateChange",this._stateChange,this)},_attachCls:function(){var w=this.get("cls");w&&this.el.addClass(w)},_stateChange:function(w){this["_"+
w.newVal]();this._attachCls()},_action:function(w){this.fire(this.get("state")+"Click",w);this.fire("click",w);w.preventDefault()},_on:function(){this.el[0].className="ke-triplebutton ke-triplebutton-on"},_off:function(){this.el[0].className="ke-triplebutton ke-triplebutton-off"},_disabled:function(){this.el[0].className="ke-triplebutton ke-triplebutton-disabled"}});q.TripleButton=z});
KISSY.Editor.add("contextmenu",function(){function z(u){this.cfg=B.clone(u);q.Utils.lazyRun(this,"_prepareShow","_realShow")}var q=KISSY.Editor,B=KISSY,s=B.Node,w=B.Event,t=[];z.register=function(u,e){var g=new z(e);t.push({doc:u,tags:e.tags,instance:g});if(!u.ke_contextmenu){u.ke_contextmenu=1;w.on(u,"mousedown",z.hide);w.on(u,"contextmenu",function(i){z.hide.call(this);for(var l=new s(i.target);l;){var v=l._4e_name(),k=false;if(v=="body")break;for(var m=0;m<t.length;m++){var o=t[m].tags,a=t[m].instance;
if(u===t[m].doc&&B.inArray(v,o)){i.preventDefault();k=true;a.show(q.Utils.getXY(i.pageX,i.pageY,u,document));break}}if(k)break;l=l.parent()}})}return g};z.hide=function(){for(var u=0;u<t.length;u++){var e=t[u].instance;this===t[u].doc&&e.hide()}};var p=q.SimpleOverlay;B.augment(z,{_init:function(){var u=this,e=u.cfg,g=e.funcs;u.elDom=new s("<div class='ke-contextmenu'></div>");var i=u.elDom;i.css("width",e.width);document.body.appendChild(i[0]);u.el=new p({el:i});for(var l in g){e=new s("<a href='#'>"+
l+"</a>");i[0].appendChild(e[0]);(function(v,k){v.on("click",function(m){k();u.hide();m.halt()})})(e,g[l])}},hide:function(){this.el&&this.el.hide()},_realShow:function(u){this.el.show(u)},_prepareShow:function(){this._init()},show:function(u){this._prepareShow(u)}});q.ContextMenu=z;console.log("contexmenu loaded!")});
KISSY.Editor.add("overlay",function(){function z(){var e=this;z.superclass.constructor.apply(e,arguments);e._init();if(B.UA.ie===6){e.on("show",function(){var g=e.get("el"),i=parseInt(g.css("width"));g=g[0].offsetHeight;u&&u.css({width:i+"px",height:g+"px"});u&&u.offset(e.get("el").offset())});e.on("hide",function(){u&&u.offset({left:-999,top:-999})})}if(e.get("mask")){e.on("show",function(){t&&t.css({left:"0px",top:"0px"});p&&p.css({left:"0px",top:"0px"})});e.on("hide",function(){t&&t.css({left:"-9999px",
top:"-9999px"});p&&p.css({left:"-9999px",top:"-9999px"})})}e.hide()}var q=KISSY.Editor,B=KISSY,s=B.Node,w=B.DOM,t,p,u;z.init=function(){var e=document.body;t=new s('<div class="ke-mask">&nbsp;</div>');t.css({left:"-9999px",top:"-9999px"});t.css({width:"100%",height:w.docHeight()+"px",opacity:0.4});t.appendTo(e);if(B.UA.ie==6){u=new s("<iframe class='ke-dialog-iframe'></iframe>");e.appendChild(u[0]);p=new s("<iframe class='ke-mask'></iframe>");p.css({left:"-9999px",top:"-9999px"});p.css({width:"100%",
height:w.docHeight()+"px",opacity:0.4});p.appendTo(e)}z.init=null};z.ATTRS={title:{value:""},width:{value:"450px"},visible:{value:true},mask:{value:false}};B.extend(z,B.Base,{_init:function(){var e=this,g=e.get("el");e.on("afterVisibleChange",function(i){if(i=i.newVal){typeof i=="boolean"?e.center():g.offset(i);e.fire("show")}else{g.css({left:"-9999px",top:"-9999px"});e.fire("hide")}});if(!g){g=new s("<div class='ke-dialog' style='width:"+e.get("width")+"'><div class='ke-hd clearfix'><div class='ke-hd-title'><h1>"+
e.get("title")+"</h1></div><div class='ke-hd-x'><a class='ke-close' href='#'>X</a></div></div><div class='ke-bd'></div><div class='ke-ft'><a href='#' class='ke-focus'></a></div></div>");document.body.appendChild(g[0]);e.set("el",g);e.el=g;e.body=g.one(".ke-bd");e._close=g.one(".ke-close");e._title=g.one(".ke-hd-title").one("h1");e.on("titleChange",function(i){e._title.html(i.newVal)});e.on("widthChange",function(i){e.el.css("width",i.newVal)});e._close.on("click",function(i){i.preventDefault();e.hide()})}},
center:function(){var e=this.get("el"),g=parseInt(e.css("width")),i=e[0].offsetHeight,l=w.viewportWidth(),v=w.viewportHeight();g=(l-g)/2+w.scrollLeft();i=(v-i)/2+w.scrollTop();e.css({left:g+"px",top:i+"px"})},_prepareShow:function(){z.init()},_realShow:function(e){this.get("el");this.set("visible",e||true)},show:function(e){this._prepareShow(e)},hide:function(){this.get("el");this.set("visible",false)}});q.Utils.lazyRun(z.prototype,"_prepareShow","_realShow");q.SimpleOverlay=z});
KISSY.Editor.add("clipboard",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node,w=B.UA,t=q.Range,p=q.RANGE,u=B.Event;q.Paste||function(){function e(g){this.editor=g;this._init()}B.augment(e,{_init:function(){var g=this.editor;w.ie?u.on(g.document,"keydown",this._paste,this):u.on(g.document,"paste",this._paste,this)},_paste:function(g){if(!(g.type==="keydown"&&!(g.keyCode===86&&(g.ctrlKey||g.metaKey)))){var i=this.editor;g=i.document;var l=i.getSelection(),v=new t(g),k=new s(w.webkit?"<body></body>":
"<div></div>",null,g);w.webkit&&k[0].appendChild(g.createTextNode("\u00a0"));g.body.appendChild(k[0]);k.css({position:"absolute",top:l.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});k.css("left","-1000px");var m=l.createBookmarks();v.setStartAt(k,p.POSITION_AFTER_START);v.setEndAt(k,p.POSITION_BEFORE_END);v.select(true);setTimeout(function(){k.remove();var o;k=w.webkit&&(o=k._4e_first())&&o[0]&&o.hasClass("Apple-style-span")?o:k;l.selectBookmarks(m);i.insertHtml(k.html())},
0)}}});q.Paste=e}();z.addPlugin(function(){new q.Paste(z)})});
KISSY.Editor.add("color",function(z){function q(h){return("0"+h).slice(h.length-1,h.length+1)}function B(h){h=w.trim(h);if(h.charAt(0)=="#")h=h.substring(1);h=h.replace(/\s+/g,"");var r="";if(/^[0-9a-f]{3,3}$/i.test(h))r=h.replace(/[0-9a-f]/ig,function(d){return d+d});else{var b=h.match(i);if(b&&b[0])for(h=1;h<4;h++)r+=q(parseInt(b[h]).toString(16));else r=h}return"#"+r.toLowerCase()}for(var s=KISSY.Editor,w=KISSY,t=w.Node,p=w.Event,u=s.SimpleOverlay,e=s.Style,g=w.DOM,i=/^rgb\((\d+),(\d+),(\d+)\)$/i,
l="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF".split(/,/),v={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},k={element:"span",styles:{"background-color":"#(color)"}},m="<div class='ke-popup-wrap ke-color-wrap'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\"><span>\u6e05\u9664</span></a><table>",
o={},a={},c=0;c<5;c++){m+="<tr>";for(var j=0;j<8;j++){var f=B(l[8*c+j]);m+="<td>";m+="<a href='javascript:void(0);' class='ke-color-a'><span style='background-color:"+f+"'></span></a>";m+="</td>";o[f]=new e(k,{color:f});a[f]=new e(v,{color:f})}m+="</tr>"}o.inherit=new e(k,{color:"inherit"});a.inherit=new e(v,{color:"inherit"});m+="</table></div>";s.ColorSupport||function(){function h(b){h.superclass.constructor.call(this,b);this._init()}var r=s.TripleButton;h.ATTRS={editor:{},styles:{},contentCls:{},
text:{}};w.extend(h,w.Base,{_init:function(){var b=this.get("editor").toolBarDiv;b=new r({container:b,title:this.get("title"),contentCls:this.get("contentCls")});b.on("offClick",this._showColors,this);this.el=b;s.Utils.lazyRun(this,"_prepare","_real")},_hidePanel:function(b){var d=this;g._4e_ascendant(b.target,function(n){return n[0]===d.el.el[0]},true)||this.colorWin.hide()},_selectColor:function(b){b.halt();var d=this.get("editor");b=b.target;if(g._4e_name(b)=="span"||g._4e_name(b)=="a"){b=new t(b);
if(b._4e_name()=="a")b=b.one("span");var n=this.get("styles");d.fire("save");b._4e_style("background-color")?n[B(b._4e_style("background-color"))].apply(d.document):n.inherit.remove(d.document);d.fire("save");d.focus();this.colorWin.hide()}},_prepare:function(){this.colorPanel=new t(m);this.colorWin=new u({el:this.colorPanel,mask:false});document.body.appendChild(this.colorPanel[0]);this.colorPanel.on("click",this._selectColor,this);p.on(document,"click",this._hidePanel,this);p.on(z.document,"click",
this._hidePanel,this)},_real:function(){var b=this.el.el.offset();b.top+=this.el.el.height()+5;if(b.left+this.colorPanel.width()>g.viewportWidth()-60)b.left=g.viewportWidth()-this.colorPanel.width()-60;this.colorWin.show(b)},_showColors:function(b){this._prepare(b)}});s.ColorSupport=h}();z.addPlugin(function(){new s.ColorSupport({editor:z,styles:o,title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-bgcolor",text:"bgcolor"});new s.ColorSupport({editor:z,styles:a,title:"\u6587\u672c\u989c\u8272",
contentCls:"ke-toolbar-color",text:"color"})})});
KISSY.Editor.add("elementpaths",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node,w=B.DOM;q.ElementPaths||function(){function t(p){this.cfg=p;this._cache=[];this._init()}B.augment(t,{_init:function(){var p=this.cfg.editor;this.holder=new s("<div>");this.holder.appendTo(p.statusDiv);p.on("selectionChange",this._selectionChange,this)},_selectionChange:function(p){var u=this.cfg.editor,e=this.holder;e=e[0]||e;p=p.path.elements;var g,i;g=this._cache;for(i=0;i<g.length;i++){g[i].detach("click");g[i].remove()}this._cache=
[];for(i=0;i<p.length;i++){g=p[i];var l=new s("<a href='#' class='elementpath'>"+(g.attr("_ke_real_element_type")||g._4e_name())+"</a>");this._cache.push(l);(function(v){l.on("click",function(k){k.halt();u.focus();setTimeout(function(){u.getSelection().selectElement(v)},50)})})(g);e.firstChild?w.insertBefore(l[0],e.firstChild):e.appendChild(l[0])}}});q.ElementPaths=t}();z.addPlugin(function(){new q.ElementPaths({editor:z})})});
KISSY.Editor.add("enterkey",function(z){var q=KISSY.Editor,B=KISSY,s=B.UA,w=/^h[1-6]$/,t=q.XHTML_DTD,p=B.Node,u=B.Event,e=q.Walker,g=q.ElementPath;q.enterBlock||function(){function i(k){k=k.getSelection().getRanges();for(var m=k.length-1;m>0;m--)k[m].deleteContents();return k[0]}function l(k){var m=i(k),o=m.document;if(m.checkStartOfBlock()&&m.checkEndOfBlock()){var a=(new g(m.startContainer)).block;if(a&&(a._4e_name()=="li"||a.parent()._4e_name()=="li")){k.execCommand("outdent");return}}var c=m.splitBlock("p");
if(c){k=c.previousBlock;a=c.nextBlock;var j=c.wasStartOfBlock,f=c.wasEndOfBlock,h;if(a){h=a.parent();if(h._4e_name()=="li"){a._4e_breakParent(h);a._4e_move(a._4e_next(),true)}}else if(k&&(h=k.parent())&&h._4e_name()=="li"){k._4e_breakParent(h);m.moveToElementEditablePosition(k._4e_next());k._4e_move(k._4e_previous())}if(!j&&!f){if(a._4e_name()=="li"&&(h=a._4e_first(e.invisible(true)))&&B.inArray(h._4e_name(),["ul","ol"]))(s.ie?new p(o.createTextNode("\u00a0")):new p(o.createElement("br"))).insertBefore(h);
a&&m.moveToElementEditablePosition(a)}else{var r;if(k){if(k._4e_name()=="li"||!w.test(k._4e_name()))r=k._4e_clone()}else if(a)r=a._4e_clone();r||(r=new p("p",null,o));if(h=c.elementPath){c=0;for(var b=h.elements.length;c<b;c++){var d=h.elements[c];if(d._4e_equals(h.block)||d._4e_equals(h.blockLimit))break;if(t.$removeEmpty[d.getName()]){d=d._4e_clone();r._4e_moveChildren(d);r.append(d)}}}s.ie||r._4e_appendBogus();m.insertNode(r);if(s.ie&&j&&(!f||!k[0].childNodes.length)){m.moveToElementEditablePosition(f?
k:r);m.select()}m.moveToElementEditablePosition(j&&!f?a:r)}if(!s.ie)if(a){o=new p(o.createElement("span"));o.html("&nbsp;");m.insertNode(o);o._4e_scrollIntoView();m.deleteContents()}else r._4e_scrollIntoView();m.select()}}function v(k){u.on(k.document,"keydown",function(m){if(m.keyCode===13)if(!m.shiftKey){k.execCommand("enterBlock");m.preventDefault()}})}v.enterBlock=l;q.EnterKey=v}();z.addPlugin(function(){z.addCommand("enterBlock",{exec:q.EnterKey.enterBlock});q.EnterKey(z)})});
KISSY.Editor.add("fakeobjects",function(){var z=KISSY.Editor,q=KISSY,B=q.Node,s=z.NODE,w=z.HtmlParser,t=q.Editor,p=z.HtmlDataProcessor,u=p&&p.htmlFilter;z.FakeObjects||function(){var e={elements:{$:function(g){var i=g.attributes;if((i=(i=(i=i&&i._ke_realelement)&&new w.Fragment.FromHtml(decodeURIComponent(i)))&&i.children[0])&&g.attributes._ke_resizable){var l=g.attributes.style;if(l){var v=/(?:^|\s)width\s*:\s*(\d+)/i.exec(l);g=v&&v[1];l=(v=/(?:^|\s)height\s*:\s*(\d+)/i.exec(l))&&v[1];if(g)i.attributes.width=
g;if(l)i.attributes.height=l}}return i}}};u&&u.addRules(e);p&&q.mix(p,{createFakeParserElement:function(g,i,l,v){var k;k=new w.BasicWriter;g.writeHtml(k);k=k.getHtml();var m=g.attributes.style;if(g.attributes.width)m="width:"+g.attributes.width+"px;"+m;if(g.attributes.height)m="height:"+g.attributes.height+"px;"+m;g={"class":i,src:z.Config.base+"assets/spacer.gif",_ke_realelement:encodeURIComponent(k),_ke_real_node_type:g.type,style:m,align:g.attributes.align||""};if(l)g._ke_real_element_type=l;if(v)g._ke_resizable=
v;return new w.Element("img",g)}});z.FakeObjects=1}();q.augment(t,{createFakeElement:function(e,g,i,l){var v=e.attr("style")||"";if(e.attr("width"))v="width:"+e.attr("width")+"px;"+v;if(e.attr("height"))v="height:"+e.attr("height")+"px;"+v;e={"class":g,src:z.Config.base+"assets/spacer.gif",_ke_realelement:encodeURIComponent(e._4e_outerHtml()),_ke_real_node_type:e[0].nodeType,align:e.attr("align")||"",style:v};if(i)e._ke_real_element_type=i;if(l)e._ke_resizable=l;return new B("<img/>",e,this.document)},
restoreRealElement:function(e){if(e.attr("_ke_real_node_type")!=s.NODE_ELEMENT)return null;return new B(decodeURIComponent(e.attr("_ke_realelement")),this.document)}})});
KISSY.Editor.add("flash",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node,w=q.TripleButton,t=q.SimpleOverlay,p=/\.swf(?:$|\?)/i,u=q.HtmlDataProcessor,e="niftyplayer.swf",g=u&&u.dataFilter;q.Flash||function(){function i(k){k=k.attributes;return k.type=="application/x-shockwave-flash"||p.test(k.src||"")}function l(k){return k.indexOf(e)!=-1}function v(k){this.editor=k;this._init()}g&&g.addRules({elements:{object:function(k){var m=k.attributes,o="ke_flash",a="flash";if(!(m.classid&&String(m.classid).toLowerCase())){for(m=
0;m<k.children.length;m++)if(k.children[m].name=="embed"){if(!i(k.children[m]))return null;if(l(k.children[m].attributes.src)){o="ke_music";a="music"}return u.createFakeParserElement(k,o,a,true)}return null}for(m=0;m<k.children.length;m++){var c=k.children[m];if(c.name=="param"&&c.attributes.name=="movie")if(l(c.attributes.value)){o="ke_music";a="music";break}}return u.createFakeParserElement(k,o,a,true)},embed:function(k){if(!i(k))return null;var m="ke_flash",o="flash";if(l(k.attributes.src)){m=
"ke_music";o="music"}return u.createFakeParserElement(k,m,o,true)}}},5);B.augment(v,{_init:function(){this.el=new w({container:this.editor.toolBarDiv,contentCls:"ke-toolbar-flash",title:"Flash"});this.el.on("click",this._showConfig,this);q.Utils.lazyRun(this,"_prepareShow","_realShow")},_prepareShow:function(){this.d=new t({title:"\u7f16\u8f91flash",width:"350px",mask:true});this.d.body.html("<div style='margin:10px;'><p><label>\u5730\u5740\uff1a<input class='ke-flash-url' style='width:280px' /></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\uff1a<input class='ke-flash-width' style='width:120px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\uff1a<input class='ke-flash-height' style='width:110px' /></label></p><p style='margin:5px 0;text-align:right;'><button>\u786e\u5b9a</button></p></div>");
this._initD()},_realShow:function(){this.d.show()},_showConfig:function(){this._prepareShow()},_initD:function(){var k=this.d;this.dHeight=k.el.one(".ke-flash-height");this.dWidth=k.el.one(".ke-flash-width");this.dUrl=k.el.one(".ke-flash-url");k.el.one("button").on("click",this._gen,this)},_gen:function(){var k=this.editor,m=this.dUrl.val();if(m){m=new s("<object "+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+
"' ":" ")+'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="quality" value="high" /><param name="movie" value="'+m+'" /><embed '+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+"' ":" ")+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+m+'" type="application/x-shockwave-flash"></embed></object>',
null,k.document);m=k.createFakeElement?k.createFakeElement(m,"ke_flash","flash",true):m;k.insertElement(m);this.d.hide()}}});q.Flash=v}();z.addPlugin(function(){new q.Flash(z)})});
KISSY.Editor.add("font",function(z){var q=KISSY.Editor,B=KISSY,s=q.Style,w=q.TripleButton,t=B.Node,p=["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px","108px"],u={},e="<select title='\u5927\u5c0f'><option value=''>\u5927\u5c0f / \u6e05\u9664</option>",g={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]},i=["\u5b8b\u4f53","\u9ed1\u4f53","\u96b6\u4e66","\u6977\u4f53_GB2312","\u5fae\u8f6f\u96c5\u9ed1","Georgia","Times New Roman",
"Impact","Courier New","Arial","Verdana","Tahoma"],l={},v="<select title='\u5b57\u4f53'><option value=''>\u5b57\u4f53 / \u6e05\u9664</option>",k={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},m;for(m=0;m<p.length;m++){var o=p[m];u[o]=new s(g,{size:o});e+="<option value='"+o+"'>"+o+"</option>"}e+="</select>";for(m=0;m<i.length;m++){p=i[m];l[p]=new s(k,{family:p});v+="<option value='"+p+"'>"+p+"</option>"}v+="</select>";q.Font||function(){function a(j){a.superclass.constructor.call(this,
j);this._init()}function c(j){c.superclass.constructor.call(this,j);this._init()}a.ATTRS={v:{value:""},html:{},styles:{},editor:{}};B.extend(a,B.Base,{_init:function(){var j=this.get("editor"),f=j.toolBarDiv,h=this.get("html");this.el=new t(h);f[0].appendChild(this.el[0]);this.el.on("change",this._change,this);j.on("selectionChange",this._selectionChange,this);this.on("afterVChange",this._vChange,this)},_vChange:function(j){var f=this.get("editor"),h=j.newVal;j=j.preVal;var r=this.get("styles");f.focus();
f.fire("save");if(h)r[h].apply(f.document);else{h=j;r[h].remove(f.document)}f.fire("save")},_change:function(){this.set("v",this.el.val())},_selectionChange:function(j){this.get("editor");var f=this.get("v");j=j.path.elements;for(var h=this.get("styles"),r=0,b;r<j.length;r++){b=j[r];for(var d in h)if(h[d].checkElementRemovable(b,true)){if(d!=f){this._set("v",d);this.el.val(d)}return}}if(f!=""){this._set("v","");this.el.val("")}}});c.ATTRS={editor:{},text:{},contentCls:{},title:{},style:{}};B.extend(c,
B.Base,{_init:function(){var j=this.get("editor"),f=this.get("text");this.get("style");var h=this.get("title");this.el=new w({text:f,title:h,contentCls:this.get("contentCls"),container:j.toolBarDiv});this.el.on("offClick",this._on,this);this.el.on("onClick",this._off,this);j.on("selectionChange",this._selectionChange,this)},_on:function(){var j=this.get("editor");this.get("text");var f=this.get("style");this.get("title");f.apply(j.document);j.notifySelectionChange();j.focus()},_off:function(){var j=
this.get("editor");this.get("text");var f=this.get("style");this.get("title");f.remove(j.document);j.notifySelectionChange();j.focus()},_selectionChange:function(j){this.get("editor");this.get("text");var f=this.get("style");this.get("title");f.checkActive(j.path)?this.el.set("state",w.ON):this.el.set("state",w.OFF)}});a.SingleFont=c;q.Font=a}();z.addPlugin(function(){new q.Font({editor:z,styles:u,html:e});new q.Font({editor:z,styles:l,html:v});new q.Font.SingleFont({contentCls:"ke-toolbar-bold",
title:"\u7c97\u4f53",editor:z,style:new s({element:"strong"})});new q.Font.SingleFont({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53",editor:z,style:new s({element:"em"})});new q.Font.SingleFont({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf",editor:z,style:new s({element:"u"})});new q.Font.SingleFont({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf",editor:z,style:new s({element:"del"})})})});
KISSY.Editor.add("format",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node;q.Format||function(){function w(i){w.superclass.constructor.call(this,i);this.el=new s(t);this._init()}var t="<select title='\u683c\u5f0f'>",p={"\u6807\u9898 / \u6e05\u9664":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},u={},e=q.Style;for(var g in p)if(p[g]){u[p[g]]=new e({element:p[g]});t+="<option value='"+p[g]+"'>"+g+"</option>"}t+="</select>";
w.ATTRS={v:{value:"p"},editor:{}};B.extend(w,B.Base,{_init:function(){var i=this.get("editor"),l=this.el;i.toolBarDiv[0].appendChild(this.el[0]);l.on("change",this._change,this);i.on("selectionChange",this._selectionChange,this);this.on("afterVChange",this._vChange,this)},_vChange:function(i){var l=this.get("editor");i=i.newVal;l.focus();l.fire("save");u[i].apply(l.document);l.fire("save");l.fire("formatChange",this.get("v"))},_change:function(){this.set("v",this.el.val())},_selectionChange:function(i){this.get("editor");
var l=this.get("v");i=i.path;for(var v in u)if(u[v].checkActive(i)){if(v!=l){this._set("v",v);this.el.val(v)}return}this._set("v","p");this.el.val("p")}});q.Format=w}();z.addPlugin(function(){new q.Format({editor:z})})});
KISSY.Editor.add("htmlparser-basicwriter",function(){function z(){this._={output:[]}}var q=KISSY.Editor,B=q.Utils;if(!q.HtmlParser.BasicWriter){KISSY.augment(z,{openTag:function(s){this._.output.push("<",s)},openTagClose:function(s,w){w?this._.output.push(" />"):this._.output.push(">")},attribute:function(s,w){if(typeof w=="string")w=B.htmlEncodeAttr(w);this._.output.push(" ",s,'="',w,'"')},closeTag:function(s){this._.output.push("</",s,">")},text:function(s){this._.output.push(s)},comment:function(s){this._.output.push("<!--",
s,"--\>")},write:function(s){this._.output.push(s)},reset:function(){this._.output=[];this._.indent=false},getHtml:function(s){var w=this._.output.join("");s&&this.reset();return w}});q.HtmlParser.BasicWriter=z}});
KISSY.Editor.add("htmlparser-element",function(){function z(w,t){this.name=w;this.attributes=t||(t={});this.children=[];var p=t._ke_real_element_type||w;t=q.XHTML_DTD;p=!!(t.$nonBodyContent[p]||t.$block[p]||t.$listItem[p]||t.$tableContent[p]||t.$nonEditable[p]||p=="br");var u=!!t.$empty[w];this.isEmpty=u;this.isUnknown=!t[w];this._={isBlockLike:p,hasInlineStarted:u||!p}}var q=KISSY.Editor;if(!q.HtmlParser.Element){var B=q.NODE,s=function(w,t){w=w[0];t=t[0];return w<t?-1:w>t?1:0};KISSY.augment(z,{type:B.NODE_ELEMENT,
add:q.HtmlParser.Fragment.prototype.add,clone:function(){return new z(this.name,this.attributes)},writeHtml:function(w,t){var p=this.attributes,u=this,e=u.name,g,i,l,v;u.filterChildren=function(){if(!v){var o=new q.HtmlParser.BasicWriter;q.HtmlParser.Fragment.prototype.writeChildrenHtml.call(u,o,t);u.children=(new q.HtmlParser.Fragment.fromHtml(o.getHtml())).children;v=1}};if(t){for(;;){if(!(e=t.onElementName(e)))return;u.name=e;if(!(u=t.onElement(u)))return;u.parent=this.parent;if(u.name==e)break;
if(u.type!=B.NODE_ELEMENT){u.writeHtml(w,t);return}e=u.name;if(!e){this.writeChildrenHtml.call(u,w,v?null:t);return}}p=u.attributes}w.openTag(e,p);for(var k=[],m=0;m<2;m++)for(g in p){i=g;l=p[g];if(m==1)k.push([g,l]);else if(t){for(;;)if(i=t.onAttributeName(g))if(i!=g){delete p[g];g=i}else break;else{delete p[g];break}if(i)if((l=t.onAttribute(u,i,l))===false)delete p[i];else p[i]=l}}w.sortAttributes&&k.sort(s);p=k.length;for(m=0;m<p;m++){g=k[m];w.attribute(g[0],g[1])}w.openTagClose(e,u.isEmpty);if(!u.isEmpty){this.writeChildrenHtml.call(u,
w,v?null:t);w.closeTag(e)}},writeChildrenHtml:function(){q.HtmlParser.Fragment.prototype.writeChildrenHtml.apply(this,arguments)}});q.HtmlParser.Element=z}});
KISSY.Editor.add("htmlparser-filter",function(){function z(e){this._={elementNames:[],attributeNames:[],elements:{$length:0},attributes:{$length:0}};e&&this.addRules(e,10)}function q(e,g){for(var i=0;e&&i<g.length;i++){var l=g[i];e=e.replace(l[0],l[1])}return e}function B(e,g,i){if(typeof g=="function")g=[g];var l,v;v=e.length;var k=g&&g.length;if(k){for(l=0;l<v&&e[l].pri<i;l++);for(v=k-1;v>=0;v--)if(k=g[v]){k.pri=i;e.splice(l,0,k)}}}function s(e,g,i){if(g)for(var l in g){var v=e[l];e[l]=w(v,g[l],
i);v||e.$length++}}function w(e,g,i){if(g){g.pri=i;if(e){if(e.splice)B(e,g,i);else{e=e.pri>i?[g,e]:[e,g];e.filter=t}return e}else return g.filter=g}}function t(e){for(var g=e.type||e instanceof p.HtmlParser.Fragment,i=0;i<this.length;i++){if(g)var l=e.type,v=e.name;var k=this[i].apply(window,arguments);if(k===false)return k;if(g){if(k&&(k.name!=v||k.type!=l))return k}else if(typeof k!="string")return k;k!=undefined&&(e=k)}return e}var p=KISSY.Editor,u=p.NODE;if(!p.HtmlParser.Filter){KISSY.augment(z,
{addRules:function(e,g){if(typeof g!="number")g=10;B(this._.elementNames,e.elementNames,g);B(this._.attributeNames,e.attributeNames,g);s(this._.elements,e.elements,g);s(this._.attributes,e.attributes,g);this._.text=w(this._.text,e.text,g)||this._.text;this._.comment=w(this._.comment,e.comment,g)||this._.comment;this._.root=w(this._.root,e.root,g)||this._.root},onElementName:function(e){return q(e,this._.elementNames)},onAttributeName:function(e){return q(e,this._.attributeNames)},onText:function(e){var g=
this._.text;return g?g.filter(e):e},onComment:function(e,g){var i=this._.comment;return i?i.filter(e,g):e},onFragment:function(e){var g=this._.root;return g?g.filter(e):e},onElement:function(e){for(var g=[this._.elements["^"],this._.elements[e.name],this._.elements.$],i,l=0;l<3;l++)if(i=g[l]){i=i.filter(e,this);if(i===false)return null;if(i&&i!=e)return this.onNode(i);if(e.parent&&!e.name)break}return e},onNode:function(e){var g=e.type;return g==u.NODE_ELEMENT?this.onElement(e):g==u.NODE_TEXT?new p.HtmlParser.Text(this.onText(e.value)):
null},onAttribute:function(e,g,i){if(g=this._.attributes[g]){e=g.filter(i,e,this);if(e===false)return false;if(typeof e!="undefined")return e}return i}});p.HtmlParser.Filter=z}});
KISSY.Editor.add("htmlparser-fragment",function(){function z(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}}var q=KISSY.Editor;if(!q.HtmlParser.Fragment){var B={colgroup:1,dd:1,dt:1,li:1,option:1,p:1,td:1,tfoot:1,th:1,thead:1,tr:1},s=KISSY,w=q.Utils,t=q.NODE,p=q.XHTML_DTD,u=w.mix({table:1,ul:1,ol:1,dl:1},p.table,p.ul,p.ol,p.dl),e=p.$list,g=p.$listItem;z.FromHtml=function(i,l){function v(d){var n;if(c.length>0)for(var A=0;A<c.length;A++){var x=c[A],C=x.name,I=
p[C],y=f.name&&p[f.name];if((!y||y[C])&&(!d||!I||I[d]||!p[d])){if(!n){k();n=1}x=x.clone();x.parent=f;f=x;c.splice(A,1);A--}}}function k(){for(;j.length;)f.add(j.shift())}function m(d,n,A){n=n||f||a;if(l&&!n.type){var x,C;if((x=d.attributes&&(C=d.attributes._ke_real_element_type)?C:d.name)&&!(x in p.$body)&&!(x in p.$nonBodyContent)){x=f;f=n;o.onTagOpen(l,{});n=f;if(A)f=x}}if(d._.isBlockLike&&d.name!="pre"){A=d.children.length;if((x=d.children[A-1])&&x.type==t.NODE_TEXT)if(C=w.rtrim(x.value))x.value=
C;else d.children.length=A-1}n.add(d);if(d.returnPoint){f=d.returnPoint;delete d.returnPoint}}var o=new q.HtmlParser,a=new z,c=[],j=[],f=a,h=false,r;o.onTagOpen=function(d,n,A){var x=new q.HtmlParser.Element(d,n);if(x.isUnknown&&A)x.isEmpty=true;if(p.$removeEmpty[d])c.push(x);else{if(d=="pre")h=true;else if(d=="br"&&h){f.add(new q.HtmlParser.Text("\n"));return}if(d=="br")j.push(x);else{var C=f.name,I=C&&(p[C]||(f._.isBlockLike?p.div:p.span));if(I&&!x.isUnknown&&!f.isUnknown&&!I[d]){I=false;var y;
if(d in e&&C in e){C=f.children;(C=C[C.length-1])&&C.name in g||m(C=new q.HtmlParser.Element("li"),f);r=f;y=C}else if(d==C)m(f,f.parent);else{if(u[C])r||(r=f);else{m(f,f.parent,true);B[C]||c.unshift(f)}I=true}f=y?y:f.returnPoint||f.parent;if(I){o.onTagOpen.apply(this,arguments);return}}v(d);k();x.parent=f;x.returnPoint=r;r=0;if(x.isEmpty)m(x);else f=x}}};o.onTagClose=function(d){for(var n=c.length-1;n>=0;n--)if(d==c[n].name){c.splice(n,1);return}for(var A=[],x=[],C=f;C.type&&C.name!=d;){C._.isBlockLike||
x.unshift(C);A.push(C);C=C.parent}if(C.type){for(n=0;n<A.length;n++){var I=A[n];m(I,I.parent)}f=C;if(f.name=="pre")h=false;C._.isBlockLike&&k();m(C,C.parent);if(C==f)f=f.parent;c=c.concat(x)}if(d=="body")l=false};o.onText=function(d){if(!f._.hasInlineStarted&&!h){d=w.ltrim(d);if(d.length===0)return}k();v();if(l&&(!f.type||f.name=="body")&&w.trim(d))this.onTagOpen(l,{});h||(d=d.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));f.add(new q.HtmlParser.Text(d))};o.onCDATA=function(){};o.onComment=function(){};
o.parse(i);for(k();f.type;){i=f.parent;var b=f;if(l&&(!i.type||i.name=="body")&&!p.$body[b.name]){f=i;o.onTagOpen(l,{});i=f}i.add(b);f=i}return a};s.augment(z,{add:function(i){var l=this.children.length;if(l=l>0&&this.children[l-1]||null){if(i._.isBlockLike&&l.type==t.NODE_TEXT){l.value=w.rtrim(l.value);if(l.value.length===0){this.children.pop();this.add(i);return}}l.next=i}i.previous=l;i.parent=this;this.children.push(i);this._.hasInlineStarted=i.type==t.NODE_TEXT||i.type==t.NODE_ELEMENT&&!i._.isBlockLike},
writeHtml:function(i,l){var v;this.filterChildren=function(){var k=new q.HtmlParser.BasicWriter;this.writeChildrenHtml.call(this,k,l,true);k=k.getHtml();this.children=(new z.FromHtml(k)).children;v=1};!this.name&&l&&l.onFragment(this);this.writeChildrenHtml(i,v?null:l)},writeChildrenHtml:function(i,l){for(var v=0;v<this.children.length;v++)this.children[v].writeHtml(i,l)}});q.HtmlParser.Fragment=z}});
KISSY.Editor.add("htmlparser",function(){function z(){this._={htmlPartsRegex:new RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:[^\"'>]+)|(?:\"[^\"]*\")|(?:'[^']*'))*)\\/?>))","g")}}var q=KISSY.Editor;if(!q.HtmlParser){var B=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,s={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},w=q.XHTML_DTD;KISSY.augment(z,{onTagOpen:function(){},
onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(t){for(var p,u,e=0,g;p=this._.htmlPartsRegex.exec(t);){u=p.index;if(u>e){e=t.substring(e,u);g?g.push(e):this.onText(e)}e=this._.htmlPartsRegex.lastIndex;if(u=p[1]){u=u.toLowerCase();if(g&&w.$cdata[u]){this.onCDATA(g.join(""));g=null}if(!g){this.onTagClose(u);continue}}if(g)g.push(p[0]);else if(u=p[3]){u=u.toLowerCase();var i={},l;p=p[4];var v=!!(p&&p.charAt(p.length-1)=="/");if(p)for(;l=B.exec(p);){var k=
l[1].toLowerCase();l=l[2]||l[3]||l[4]||"";i[k]=!l&&s[k]?k:l}this.onTagOpen(u,i,v);if(!g&&w.$cdata[u])g=[]}else if(u=p[2])this.onComment(u)}t.length>e&&this.onText(t.substring(e,t.length))}});q.HtmlParser=z}});
KISSY.Editor.add("htmlparser-htmlwriter",function(){function z(){z.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=false;this.sortAttributes=true;this._.indent=false;this._.indentation="";this._.rules={};var s=q.XHTML_DTD;for(var w in B.mix({},s.$nonBodyContent,s.$block,s.$listItem,s.$tableContent))this.setRules(w,{indent:true,breakBeforeOpen:true,breakAfterOpen:true,breakBeforeClose:!s[w]["#"],breakAfterClose:true});
this.setRules("br",{breakAfterOpen:true});this.setRules("title",{indent:false,breakAfterOpen:false});this.setRules("style",{indent:false,breakBeforeClose:true});this.setRules("pre",{indent:false})}var q=KISSY.Editor,B=q.Utils;if(!q.HtmlParser.HtmlWriter){KISSY.extend(z,q.HtmlParser.BasicWriter,{openTag:function(s){var w=this._.rules[s];if(this._.indent)this.indentation();else if(w&&w.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",s)},openTagClose:function(s,w){s=this._.rules[s];
if(w)this._.output.push(this.selfClosingEnd);else{this._.output.push(">");if(s&&s.indent)this._.indentation+=this.indentationChars}s&&s.breakAfterOpen&&this.lineBreak()},attribute:function(s,w){if(typeof w=="string"){this.forceSimpleAmpersand&&(w=w.replace(/&amp;/g,"&"));w=B.htmlEncodeAttr(w)}this._.output.push(" ",s,'="',w,'"')},closeTag:function(s){var w=this._.rules[s];if(w&&w.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();
else if(w&&w.breakBeforeClose){this.lineBreak();this.indentation()}this._.output.push("</",s,">");w&&w.breakAfterClose&&this.lineBreak()},text:function(s){if(this._.indent){this.indentation();s=B.ltrim(s)}this._.output.push(s)},comment:function(s){this._.indent&&this.indentation();this._.output.push("<!--",s,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=true},indentation:function(){this._.output.push(this._.indentation);this._.indent=false},
setRules:function(s,w){var t=this._.rules[s];if(t)B.mix(t,w);else this._.rules[s]=w}});q.HtmlParser.HtmlWriter=z}});KISSY.Editor.add("htmlparser-text",function(){function z(B){this.value=B;this._={isBlockLike:false}}var q=KISSY.Editor;if(!q.HtmlParser.Text){KISSY.augment(z,{type:q.NODE.NODE_TEXT,writeHtml:function(B,s){var w=this.value;s&&!(w=s.onText(w,this))||B.text(w)}});q.HtmlParser.Text=z}});
KISSY.Editor.add("htmldataprocessor",function(){var z=KISSY.Editor;if(!z.HtmlDataProcessor){var q=KISSY.UA,B=z.HtmlParser,s=new B.Filter,w=new B.Filter,t={elementNames:[[/^script$/,""],[/^iframe$/,""],[/^style$/,""],[/^link$/,""],[/^meta$/,""],[/^\?xml:namespace$/,""]],elements:{embed:function(p){var u=p.parent;if(u&&u.name=="object"){var e=u.attributes.width;u=u.attributes.height;e&&(p.attributes.width=e);u&&(p.attributes.height=u)}},param:function(p){p.children=[];p.isEmpty=true;return p},a:function(p){if(!(p.children.length||
p.attributes.name))return false}},attributes:{"class":function(p){if(/ke_/.test(p))return p;return false}}};if(q.ie)t.attributes.style=function(p){return p.toLowerCase()};s.addRules(t);w.addRules(t);z.HtmlDataProcessor={htmlFilter:s,dataFilter:w,toHtml:function(p,u){var e=new B.HtmlWriter;B.Fragment.FromHtml(p,u).writeHtml(e,s);return e.getHtml(true)},toDataFormat:function(p,u){var e=new B.HtmlWriter;p=B.Fragment.FromHtml(p,u);e.reset();p.writeHtml(e,w);return e.getHtml(true)}}}});
KISSY.Editor.add("image",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node,w=B.DOM,t=B.Event,p=q.SimpleOverlay;q.ImageInserter||function(){function u(g){u.superclass.constructor.call(this,g);this._init()}var e=q.TripleButton;u.ATTRS={editor:{}};B.extend(u,B.Base,{_init:function(){var g=this.get("editor").toolBarDiv;this.el=new e({contentCls:"ke-toolbar-image",title:"\u56fe\u50cf",container:g});this.el.on("offClick",this.show,this);q.Utils.lazyRun(this,"_prepare","_real")},_prepare:function(){var g=
this,i=this.get("editor");this.content=new s("<div class='ke-popup-wrap' style='width:250px;padding:10px;'><p style='margin:0 0 10px'><label>\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a<br/><input value='http://' style='width: 250px;' class='ke-img-url'/></label></p><p><button class='ke-img-insert'>\u63d2\u5165</button>&nbsp;<a href='#' class='ke-img-cancel'>\u53d6\u6d88</a></p></div>");this.d=new p({el:this.content});document.body.appendChild(this.content[0]);var l=this.content.one(".ke-img-cancel"),
v=this.content.one(".ke-img-insert");this.imgUrl=this.content.one(".ke-img-url");l.on("click",function(k){this.d.hide();k.halt()},this);t.on(document,"click",this.hide,this);t.on(i.document,"click",this.hide,this);v.on("click",function(){g._insert()})},hide:function(g){var i=this;w._4e_ascendant(g.target,function(l){return l[0]===i.content[0]||l[0]===i.el.el[0]},true)||this.d.hide()},_real:function(){var g=this.el.el.offset();g.top+=this.el.el.height()+5;console.log(this.content.width(),g.left,w.viewportWidth());
if(g.left+this.content.width()>w.viewportWidth()-60)g.left=w.viewportWidth()-this.content.width()-60;this.d.show(g)},_insert:function(){var g=this.get("editor"),i=this.imgUrl.val();if(i){i=new s("<img src='"+i+"'/>",null,g.document);g.insertElement(i);this.d.hide()}},show:function(){this._prepare()}});q.ImageInserter=u}();z.addPlugin(function(){new q.ImageInserter({editor:z})})});
KISSY.Editor.add("indent",function(z){var q=KISSY.Editor,B={ol:1,ul:1},s=KISSY,w=q.Walker,t=s.DOM,p=s.Node,u=s.UA,e=q.NODE;q.Indent||function(){function g(j){this.type=j;this.indentCssProperty="margin-left";this.indentOffset=40;this.indentUnit="px"}function i(j){return j.type=CKEDITOR.NODE_ELEMENT&&j.is("li")}function l(j,f,h){var r=f.startContainer;for(j=f.endContainer;r&&r.parent()[0]!==h[0];)r=r.parent();for(;j&&j.parent()[0]!==h[0];)j=j.parent();if(r&&j){var b=r;r=[];for(var d=false;!d;){if(b[0]===
j[0])d=true;r.push(b);b=b.next()}if(!(r.length<1)){b=h._4e_parents(true);for(j=0;j<b.length;j++)if(B[b[j]._4e_name()]){h=b[j];break}b=this.type=="indent"?1:-1;j=r[0];d=r[r.length-1];r={};var n=q.ListUtils.listToArray(h,r),A=n[d._4e_getData("listarray_index")].indent;for(j=j._4e_getData("listarray_index");j<=d._4e_getData("listarray_index");j++){n[j].indent+=b;var x=n[j].parent;n[j].parent=new p(x[0].ownerDocument.createElement(x._4e_name()))}for(j=d._4e_getData("listarray_index")+1;j<n.length&&n[j].indent>
A;j++)n[j].indent+=b;d=q.ListUtils.arrayToList(n,r,null,"p",0);b=[];if(this.type=="outdent"){var C;if((C=h.parent())&&C._4e_name()=="li"){n=d.listNode.childNodes;var I;for(j=n.length-1;j>=0;j--)if((I=new p(n[j]))&&I._4e_name()=="li")b.push(I)}}if(d){t.insertBefore(d.listNode,h[0]);h._4e_remove()}if(b&&b.length)for(j=0;j<b.length;j++){for(I=h=b[j];(I=I.next())&&I._4e_name()in B;){u.ie&&!h._4e_first(function(y){return o(y)&&a(y)})&&h[0].appendChild(f.document.createTextNode("\u00a0"));h[0].appendChild(I[0])}t.insertAfter(h[0],
C[0])}for(j in r)r[j]._4e_clearMarkers(r,true)}}}function v(j,f){f=f.createIterator();f.enforceRealBlocks=true;f.enlargeBr=true;for(var h;h=f.getNextParagraph();)k.call(this,j,h)}function k(j,f){j=parseInt(f._4e_style(this.indentCssProperty),10);if(isNaN(j))j=0;j+=(this.type=="indent"?1:-1)*this.indentOffset;if(j<0)return false;j=Math.max(j,0);j=Math.ceil(j/this.indentOffset)*this.indentOffset;f.css(this.indentCssProperty,j?j+this.indentUnit:"");f[0].style.cssText===""&&f[0].removeAttribute("style");
return true}function m(j){m.superclass.constructor.call(this,j);j=this.get("editor").toolBarDiv;this.el=new c({container:j,contentCls:this.get("contentCls"),title:this.get("title")});this.indentCommand=new g(this.get("type"));this._init()}var o=w.whitespaces(true),a=w.bookmark(false,true);s.augment(g,{exec:function(j){j.focus();for(var f=j.getSelection(),h=f&&f.getRanges()[0],r=h.startContainer,b=h.endContainer,d=h.getCommonAncestor();d&&!(d[0].nodeType==e.NODE_ELEMENT&&B[d._4e_name()]);)d=d.parent();
if(d&&r[0].nodeType==e.NODE_ELEMENT&&r._4e_name()in B){r=new w(h);r.evaluator=i;h.startContainer=r.next()}if(d&&b[0].nodeType==e.NODE_ELEMENT&&b._4e_name()in B){r=new w(h);r.evaluator=i;h.endContainer=r.previous()}b=f.createBookmarks(true);if(d){for(r=d._4e_first();r&&r[0]&&r._4e_name()!="li";)r=r.next();var n=h.startContainer;(r[0]==n[0]||r._4e_contains(n))&&k.call(this,j,d)||l.call(this,j,h,d)}else v.call(this,j,h);j.focus();f.selectBookmarks(b)}});var c=q.TripleButton;m.ATTRS={type:{},contentCls:{},
editor:{}};s.extend(m,s.Base,{_init:function(){var j=this.get("editor"),f=this.el;f.on("offClick",this.exec,this);this.get("type")=="outdent"?j.on("selectionChange",this._selectionChange,this):f.set("state",c.OFF)},exec:function(){var j=this.get("editor"),f=this;j.focus();j.fire("save");setTimeout(function(){f.indentCommand.exec(j);j.fire("save");j.notifySelectionChange()},10)},_selectionChange:function(j){this.get("editor");this.get("type");var f=j.path,h=f.blockLimit;j=this.el;if(f.contains(B))j.set("state",
c.OFF);else(f=f.block||h)&&f._4e_style(this.indentCommand.indentCssProperty)?j.set("state",c.OFF):j.set("state",c.DISABLED)}});q.Indent=m}();z.addPlugin(function(){z.addCommand("outdent",new q.Indent({editor:z,title:"\u51cf\u5c11\u7f29\u8fdb\u91cf",contentCls:"ke-toolbar-outdent",type:"outdent"}));z.addCommand("indent",new q.Indent({editor:z,title:"\u589e\u52a0\u7f29\u8fdb\u91cf",contentCls:"ke-toolbar-indent",type:"indent"}))})});
KISSY.Editor.add("justify",function(z){var q=KISSY.Editor,B=KISSY,s=q.TripleButton;q.Justify||function(){function w(p,u,e,g){this.editor=p;this.v=u;this.contentCls=g;this.title=e;this._init()}var t=/(-moz-|-webkit-|start|auto)/i;B.augment(w,{_init:function(){var p=this.editor;this.el=new s({contentCls:this.contentCls,title:this.title,container:p.toolBarDiv});p.on("selectionChange",this._selectionChange,this);this.el.on("click",this._effect,this)},_effect:function(){var p=this.editor,u=p.getSelection(),
e=this.el.get("state");if(u){var g=u.createBookmarks(),i=u.getRanges(),l,v;p.fire("save");for(var k=i.length-1;k>=0;k--){l=i[k].createIterator();for(l.enlargeBr=true;v=l.getNextParagraph();){v.removeAttr("align");e==s.OFF?v.css("text-align",this.v):v.css("text-align","")}}p.focus();p.notifySelectionChange();u.selectBookmarks(g);p.fire("save")}},_selectionChange:function(p){var u=this.el;p=p.path;if(p=p.block||p.blockLimit){p=p.css("text-align").replace(t,"");p==this.v||!p&&this.v=="left"?u.set("state",
s.ON):u.set("state",s.OFF)}}});q.Justify=w}();z.addPlugin(function(){new q.Justify(z,"left","\u5de6\u5bf9\u9f50","ke-toolbar-alignleft");new q.Justify(z,"center","\u5c45\u4e2d\u5bf9\u9f50","ke-toolbar-aligncenter");new q.Justify(z,"right","\u53f3\u5bf9\u9f50","ke-toolbar-alignright")})});
KISSY.Editor.add("link",function(z){var q=KISSY.Editor,B=KISSY,s=B.DOM,w=B.Event,t=q.TripleButton,p=q.Style,u=B.Node,e=q.Range,g=q.SimpleOverlay,i=q.HtmlDataProcessor,l=i&&i.dataFilter;q.Link||function(){function v(o){this.editor=o;this._init()}l&&l.addRules({elements:{a:function(o){for(var a in o.attributes)a=="href"||a=="target"||delete o.attributes[a]}}});var k={element:"a",attributes:{href:"#(href)",target:"#(target)"}};v.init=function(){var o=this;o.d=new g({title:"\u7f16\u8f91\u8d85\u94fe\u63a5",
mask:true,width:"300px"});o.d.body.html(m);o.urlEl=o.d.body.one(".ke-link-url");o.targetEl=o.d.body.one(".ke-link-blank");var a=o.d.body.one(".ke-link-cancel");o.ok=o.d.body.one(".ke-link-ok");v.ok.on("click",function(c){v.d.link._link();c.halt()},this);a.on("click",function(c){o.d.hide();c.halt()},o);v.init=null};v.tip=function(){var o=new u('<div class="ke-bubbleview-bubble" onmousedown="return false;">\u524d\u5f80\u94fe\u63a5\uff1a  <a href=""  target="_blank" class="ke-bubbleview-url"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span></div>');
o._4e_unselectable();this.tipwin=new g({el:o});document.body.appendChild(o[0]);this.tipurl=o.one(".ke-bubbleview-url");var a=o.one(".ke-bubbleview-change");o=o.one(".ke-bubbleview-remove");a.on("click",function(c){v.tipwin.link.show();c.halt()});o.on("click",function(c){v.tipwin.link._removeLink();c.halt()});v.tip=null};var m="<div style='padding: 10px;'><p><label>URL\uff1a<input class='ke-link-url' style='width:230px' value='http://'/></label></p><p style='margin-top: 5px;padding-left:35px'><label><input class='ke-link-blank' type='checkbox'/> &nbsp; \u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5</label></p><p style='margin-top: 5px;'><label><button class='ke-link-ok'>\u786e\u5b9a</button>&nbsp;<a href='#' class='ke-link-cancel'>\u53d6\u6d88</a></label></p></div>";
B.augment(v,{_init:function(){var o=this.editor;this.el=new t({container:o.toolBarDiv,contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u7f16\u8f91\u8d85\u94fe\u63a5"});this.el.on("click",this.show,this);o.on("selectionChange",this._selectionChange,this)},_prepareTip:function(){v.tip&&v.tip()},_realTip:function(o){var a=o._4e_getOffset(document);a.top+=o.height()+5;v.tipwin.show(a);this._a=o;v.tipwin.link=this;v.tipurl.html(o.attr("href"));v.tipurl.attr("href",o.attr("href"))},_showTip:function(o){this._prepareTip(o)},
_hideTip:function(){v.tipwin&&v.tipwin.hide()},_removeLink:function(){var o=this._a,a=this.editor;a.focus();var c={href:o.attr("href")};if(o._4e_hasAttribute("target"))c.target=o.attr("target");o=new p(k,c);a.fire("save");o.remove(a.document);a.fire("save");this._hideTip();a.focus();a.notifySelectionChange()},_selectionChange:function(o){o=o.path;var a=o.elements;if(o&&a)if(o=o.lastElement)(o=o._4e_ascendant(function(c){return c._4e_name()==="a"&&!!c.attr("href")},true))?this._showTip(o):this._hideTip()},
hide:function(){v.d.hide()},_getSelectedLink:function(){var o=this.editor;if(v.tipwin&&v.tipwin.get("visible")){(o=o.getSelection().getRanges()[0].getCommonAncestor())&&(o=o._4e_ascendant(function(a){return a._4e_name()=="a"&&!!a.attr("href")},true));if(o&&o[0]==v.tipwin.link._a[0])return o}},_link:function(){var o=this.editor,a=v.urlEl.val();o.focus();if(B.trim(a)){var c=this._getSelectedLink();if(c){var j=new e(o.document);j.selectNodeContents(c);o.getSelection().selectRanges([j]);this._removeLink()}a=
{href:a};a.target=v.targetEl[0].checked?"_blank":"_self";a=new p(k,a);o.fire("save");a.apply(o.document);o.fire("save");this.hide();o.focus();o.notifySelectionChange()}},_prepare:function(){v.init&&v.init()},_real:function(){v.d.link=this;var o=this._getSelectedLink();if(o){v.urlEl.val(o.attr("href"));v.targetEl[0].checked=o.attr("target")=="_blank"}v.d.show()},show:function(){this._prepare()}});q.Utils.lazyRun(v.prototype,"_prepare","_real");q.Utils.lazyRun(v.prototype,"_prepareTip","_realTip");
q.Link=v}();z.addPlugin(function(){new q.Link(z);var v=s._4e_getWin(z.document);w.on(v,"scroll",function(){q.Link.tipwin&&q.Link.tipwin.hide()})})});
KISSY.Editor.add("list",function(z){var q=KISSY.Editor,B={ol:1,ul:1},s=["ol","ul"],w=KISSY,t=q.RANGE,p=q.ElementPath,u=q.Walker,e=q.NODE,g=w.UA,i=w.Node,l=w.DOM;q.List||function(){function v(c){this.type=c}function k(c){k.superclass.constructor.call(this,c);c=this.get("editor").toolBarDiv;this.el=new a({contentCls:this.get("contentCls"),title:this.get("title"),container:c});this.listCommand=new v(this.get("type"));this.listCommand.state=this.get("status");this._init()}var m={listToArray:function(c,
j,f,h,r){if(!B[c._4e_name()])return[];h||(h=0);f||(f=[]);for(var b=0,d=c[0].childNodes.length;b<d;b++){var n=new i(c[0].childNodes[b]);if(n._4e_name()=="li"){var A={parent:c,indent:h,element:n,contents:[]};if(r)A.grandparent=r;else{A.grandparent=c.parent();if(A.grandparent&&A.grandparent._4e_name()=="li")A.grandparent=A.grandparent.parent()}j&&n._4e_setMarker(j,"listarray_index",f.length);f.push(A);for(var x=0,C=n[0].childNodes.length,I;x<C;x++){I=new i(n[0].childNodes[x]);I[0].nodeType==e.NODE_ELEMENT&&
B[I._4e_name()]?m.listToArray(I,j,f,h+1,A.grandparent):A.contents.push(I)}}}return f},arrayToList:function(c,j,f,h){f||(f=0);if(!c||c.length<f+1)return null;for(var r=c[f].parent[0].ownerDocument,b=r.createDocumentFragment(),d=null,n=f,A=Math.max(c[f].indent,0),x=null;;){var C=c[n];if(C.indent==A){if(!d||c[n].parent._4e_name()!=d._4e_name()){d=c[n].parent._4e_clone(false,true);b.appendChild(d[0])}x=d[0].appendChild(C.element._4e_clone(false,true)[0]);for(var I=0;I<C.contents.length;I++)x.appendChild(C.contents[I]._4e_clone(true,
true)[0]);n++}else if(C.indent==Math.max(A,0)+1){n=m.arrayToList(c,null,n,h);x.appendChild(n.listNode);n=n.nextIndex}else if(C.indent==-1&&!f&&C.grandparent){x=B[C.grandparent._4e_name()]?C.element._4e_clone(false,true)[0]:C.grandparent._4e_name()!="td"?r.createElement(h):r.createDocumentFragment();for(I=0;I<C.contents.length;I++)x.appendChild(C.contents[I]._4e_clone(true,true)[0]);if(x.nodeType==e.NODE_DOCUMENT_FRAGMENT&&n!=c.length-1){x.lastChild&&x.lastChild.nodeType==e.NODE_ELEMENT&&x.lastChild.getAttribute("type")==
"_moz"&&l._4e_remove(x.lastChild);l._4e_appendBogus(x)}if(x.nodeType==e.NODE_ELEMENT&&l._4e_name(x)==h&&x.firstChild){l._4e_trim(x);d=x.firstChild;if(d.nodeType==e.NODE_ELEMENT&&l._4e_isBlockBoundary(d)){d=r.createDocumentFragment();l._4e_moveChildren(x,d);x=d}}d=l._4e_name(x);if(!g.ie&&(d=="div"||d=="p"))l._4e_appendBogus(x);b.appendChild(x);d=null;n++}else return null;if(c.length<=n||Math.max(c[n].indent,0)<A)break}if(j)for(c=new i(b.firstChild);c&&c[0];){c[0].nodeType==e.NODE_ELEMENT&&c._4e_clearMarkers(j,
true);c=c._4e_nextSourceNode()}return{listNode:b,nextIndex:n}}},o=/^h[1-6]$/;v.prototype={changeListType:function(c,j,f,h){var r=m.listToArray(j.root,f),b=[];for(c=0;c<j.contents.length;c++){var d=j.contents[c];d=d._4e_ascendant("li",true);if(!(!d||!d[0]||d._4e_getData("list_item_processed"))){b.push(d);d._4e_setMarker(f,"list_item_processed",true)}}d=new i(j.root[0].ownerDocument.createElement(this.type));for(c=0;c<b.length;c++){var n=b[c]._4e_getData("listarray_index");r[n].parent=d}f=m.arrayToList(r,
f,null,"p");var A;r=f.listNode.childNodes.length;for(c=0;c<r&&(A=new i(f.listNode.childNodes[c]));c++)A._4e_name()==this.type&&h.push(A);l.insertBefore(f.listNode,j.root[0]);j.root._4e_remove()},createList:function(c,j,f){var h=j.contents;c=j.root[0].ownerDocument;var r=[];if(h.length==1&&h[0][0]===j.root[0]){var b=new i(c.createElement("div"));h[0][0].nodeType!=e.NODE_TEXT&&h[0]._4e_moveChildren(b);h[0][0].appendChild(b[0]);h[0]=b}j=j.contents[0].parent();for(b=0;b<h.length;b++)j=j._4e_commonAncestor(h[b].parent());
for(b=0;b<h.length;b++)for(var d=h[b],n;n=d.parent();){if(n[0]===j[0]){r.push(d);break}d=n}if(!(r.length<1)){h=new i(r[r.length-1][0].nextSibling);b=new i(c.createElement(this.type));for(f.push(b);r.length;){f=r.shift();d=new i(c.createElement("li"));if(o.test(f._4e_name()))d[0].appendChild(f[0]);else{f._4e_copyAttributes(d);f._4e_moveChildren(d);f._4e_remove()}b[0].appendChild(d[0]);g.ie||d._4e_appendBogus()}h[0]?l.insertBefore(b[0],h[0]):j[0].appendChild(b[0])}},removeList:function(c,j,f){function h(I){if((x=
new i(A[I?"firstChild":"lastChild"]))&&!(x[0].nodeType==e.NODE_ELEMENT&&x._4e_isBlockBoundary())&&(C=j.root[I?"_4e_previous":"_4e_next"](u.whitespaces(true)))&&!(x[0].nodeType==e.NODE_ELEMENT&&C._4e_isBlockBoundary({br:1})))l[I?"insertBefore":"insertAfter"](c.document.createElement("br"),x[0])}for(var r=m.listToArray(j.root,f),b=[],d=0;d<j.contents.length;d++){var n=j.contents[d];n=n._4e_ascendant("li",true);if(!(!n||n._4e_getData("list_item_processed"))){b.push(n);n._4e_setMarker(f,"list_item_processed",
true)}}n=null;for(d=0;d<b.length;d++){n=b[d]._4e_getData("listarray_index");r[n].indent=-1;n=n}for(d=n+1;d<r.length;d++)if(r[d].indent>Math.max(r[d-1].indent,0)){b=r[d-1].indent+1-r[d].indent;for(n=r[d].indent;r[d]&&r[d].indent>=n;){r[d].indent+=b;d++}d--}var A=m.arrayToList(r,f,null,"p").listNode,x,C;h(true);h();l.insertBefore(A,j.root);j.root._4e_remove()},exec:function(c){c.focus();var j=c.getSelection(),f=j&&j.getRanges();if(!(!f||f.length<1)){for(var h=j.createBookmarks(true),r=[],b={};f.length>
0;){var d=f.shift(),n=d.getBoundaryNodes(),A=n.startNode,x=n.endNode;A[0].nodeType==e.NODE_ELEMENT&&A._4e_name()=="td"&&d.setStartAt(n.startNode,t.POSITION_AFTER_START);x[0].nodeType==e.NODE_ELEMENT&&x._4e_name()=="td"&&d.setEndAt(n.endNode,t.POSITION_BEFORE_END);d=d.createIterator();for(d.forceBrBreak=false;n=d.getNextParagraph();){A=new p(n);x=A.elements;var C=null,I=false,y=A.blockLimit,D;for(A=x.length-1;A>=0&&(D=x[A]);A--)if(B[D._4e_name()]&&y.contains(D)){y._4e_removeData("list_group_object");
if(A=D._4e_getData("list_group_object"))A.contents.push(n);else{A={root:D,contents:[n]};r.push(A);D._4e_setMarker(b,"list_group_object",A)}I=true;break}if(!I)if(y._4e_getData("list_group_object"))y._4e_getData("list_group_object").contents.push(n);else{A={root:y,contents:[n]};y._4e_setMarker(b,"list_group_object",A);r.push(A)}}}for(f=[];r.length>0;){A=r.shift();if(this.state=="off")B[A.root._4e_name()]?this.changeListType(c,A,b,f):this.createList(c,A,f);else this.state=="on"&&B[A.root._4e_name()]&&
this.removeList(c,A,b)}for(A=0;A<f.length;A++){C=f[A];var G=this;(r=function(J){var N=C[J?"_4e_previous":"_4e_next"](u.whitespaces(true));if(N&&N[0]&&N._4e_name()==G.type){N._4e_remove();N._4e_moveChildren(C,J?true:false)}})();r(true)}q.Utils.clearAllMarkers(b);j.selectBookmarks(h);c.focus()}}};var a=q.TripleButton;k.ATTRS={editor:{},type:{},contentCls:{}};w.extend(k,w.Base,{_init:function(){var c=this.get("editor");this.el.on("click",this._change,this);c.on("selectionChange",this._selectionChange,
this)},_change:function(){var c=this.get("editor"),j=this.get("type"),f=this.el,h=this;c.focus();c.fire("save");setTimeout(function(){h.listCommand.state=f.get("state");h.listCommand.exec(c);c.fire("save");c.fire(j+"Change")},10)},_selectionChange:function(c){this.get("editor");var j=this.get("type"),f=c.path,h;c=this.el;var r=f.blockLimit;if(f=f.elements)for(var b=0;b<f.length&&(h=f[b])&&h[0]!==r[0];b++){var d=w.indexOf(f[b]._4e_name(),s);if(d!==-1)if(s[d]===j){c.set("state",a.ON);return}else break}c.set("state",
a.OFF)}});q.ListUtils=m;q.List=k}();z.addPlugin(function(){new q.List({editor:z,title:"\u9879\u76ee\u5217\u8868",contentCls:"ke-toolbar-ul",type:"ul"});new q.List({editor:z,title:"\u7f16\u53f7\u5217\u8868",contentCls:"ke-toolbar-ol",type:"ol"})})});
KISSY.Editor.add("maximize",function(z){var q=KISSY.Editor,B=KISSY,s=B.UA,w=B.Node,t=B.Event,p=q.TripleButton,u=B.DOM,e;q.Maximize||function(){function g(i){this.editor=i;this._init()}g.init=function(){e=new w("<iframe style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'></iframe>");document.body.appendChild(e[0]);g.init=null};B.augment(g,{_init:function(){this.el=new p({container:this.editor.toolBarDiv,cls:"ke-tool-editor-source",title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"});
this.el.on("offClick",this.maximize,this);this.el.on("onClick",this.restore,this);q.Utils.lazyRun(this,"_prepare","_real")},restore:function(){var i=this,l=i.editor;t.remove(window,"resize",i._maximize,i);this._saveEditorStatus();l.wrap.css({height:i.iframeHeight});(new w(document.body)).css({width:"",height:"",overflow:""});l.editorWrap.css({position:"static",width:i.editorWrapWidth});e.css({left:"-99999px",top:"-99999px"});window.scrollTo(i.scrollLeft,i.scrollTop);i.el.set("state",p.OFF);setTimeout(function(){i._restoreEditorStatus()},
30)},_saveSate:function(){var i=this.editor;this.iframeHeight=i.wrap._4e_style("height");this.editorWrapWidth=i.editorWrap._4e_style("width");this.scrollLeft=u.scrollLeft();this.scrollTop=u.scrollTop();window.scrollTo(0,0)},_saveEditorStatus:function(){var i=this.editor;if(s.gecko&&i.iframeFocus)this.savedRanges=(i=i.getSelection())&&i.getRanges()},_restoreEditorStatus:function(){var i=this.editor,l;if(s.gecko&&i.iframeFocus){l=i.getSelection();this.el.el[0].focus();i.focus();this.savedRanges&&l&&
l.selectRanges(this.savedRanges)}if(i.iframeFocus&&l)(l=l.getStartElement())&&l[0]&&l.scrollIntoView(i.document,false)},_maximize:function(){var i=this.editor,l=u.viewportHeight(),v=u.viewportWidth(),k=i.statusDiv?i.statusDiv.height():0,m=i.toolBarDiv.height();if(s.ie)document.body.style.overflow="hidden";else(new w(document.body)).css({width:0,height:0,overflow:"hidden"});i.editorWrap.css({position:"absolute",zIndex:9999,width:v+"px"});e.css({zIndex:9998,height:l+"px",width:v+"px"});i.editorWrap.offset({left:0,
top:0});e.css({left:0,top:0});i.wrap.css({height:l-k-m-14+"px"})},_real:function(){var i=this;this._saveEditorStatus();this._saveSate();this._maximize();this._maximize();t.on(window,"resize",i._maximize,i);this.el.set("state",p.ON);setTimeout(function(){i._restoreEditorStatus()},30)},_prepare:function(){g.init&&g.init()},maximize:function(){this._prepare()}});q.Maximize=g}();z.addPlugin(function(){new q.Maximize(z)})});
KISSY.Editor.add("music",function(z){var q=KISSY.Editor;q.MusicInserter||function(){function B(l){B.superclass.constructor.call(this,l);this._init()}var s=KISSY,w=s.Node,t=s.DOM,p=s.Event,u=q.SimpleOverlay,e=q.TripleButton,g='<object  width="165" height="37" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"><param value="'+(q.Config.base+'plugins/music/niftyplayer.swf?file=#(music)&amp;as=0"')+' name="movie"><param value="high" name="quality"><param value="#FFFFFF" name="bgcolor"><embed width="165" height="37" type="application/x-shockwave-flash" swliveconnect="true" src="'+
(q.Config.base+'plugins/music/niftyplayer.swf?file=#(music)&amp;as=0"')+'quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" bgcolor="#FFFFFF"></object>',i=/#\(music\)/g;B.ATTRS={editor:{}};s.extend(B,s.Base,{_init:function(){var l=this.get("editor").toolBarDiv;this.el=new e({contentCls:"ke-toolbar-music",title:"\u5206\u4eab\u97f3\u4e50",container:l});this.el.on("offClick",this.show,this);q.Utils.lazyRun(this,"_prepare","_real")},_prepare:function(){var l=this,v=this.get("editor");
this.content=new w("<div class='ke-popup-wrap' style='width:250px;padding:10px;'><p style='margin:0 0 10px'><label>\u8bf7\u8f93\u5165\u97f3\u4e50\u5730\u5740\uff1a<br/><input value='http://' style='width: 250px;' class='ke-music-url'/></label></p><p><button class='ke-music-insert'>\u63d2\u5165</button>&nbsp;<a href='#' class='ke-music-cancel'>\u53d6\u6d88</a></p></div>");this.d=new u({el:this.content});document.body.appendChild(this.content[0]);var k=this.content.one(".ke-music-cancel"),m=this.content.one(".ke-music-insert");
this.musicUrl=this.content.one(".ke-music-url");k.on("click",function(o){this.d.hide();o.halt()},this);p.on(document,"click",this.hide,this);p.on(v.document,"click",this.hide,this);m.on("click",function(){l._insert()})},hide:function(l){var v=this;t._4e_ascendant(l.target,function(k){return k[0]===v.content[0]||k[0]===v.el.el[0]})||this.d.hide()},_real:function(){var l=this.el.el.offset();l.top+=this.el.el.height()+5;if(l.left+this.content.width()>t.viewportWidth()-60)l.left=t.viewportWidth()-this.content.width()-
60;this.d.show(l)},_insert:function(){var l=this.get("editor"),v=this.musicUrl.val();if(v){v=new w(g.replace(i,v),null,l.document);v=l.createFakeElement?l.createFakeElement(v,"ke_music","music",true):v;l.insertElement(v);this.d.hide()}},show:function(){this._prepare()}});q.MusicInserter=B}();z.addPlugin(function(){new q.MusicInserter({editor:z})})});
KISSY.Editor.add("preview",function(z){var q=KISSY.Editor,B=KISSY,s=q.TripleButton;q.Preview||function(){function w(t){this.editor=t;this._init()}B.augment(w,{_init:function(){this.el=new s({container:this.editor.toolBarDiv,cls:"ke-tool-editor-source",title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"});this.el.on("offClick",this._show,this)},_show:function(){var t=this.editor,p=640,u=420,e=80;try{var g=window.screen;p=Math.round(g.width*0.8);u=Math.round(g.height*0.7);e=Math.round(g.width*0.1)}catch(i){}t=
t._prepareIFrameHtml().replace(/<body[^>]+>.+<\/body>/,"<body>\n"+t.getData()+"\n</body>");p=window.open("",null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+p+",height="+u+",left="+e);p.document.open();p.document.write(t);p.document.close()}});q.Preview=w}();z.addPlugin(function(){new q.Preview(z)})});
KISSY.Editor.add("removeformat",function(z){function q(i){this.editor=i;this._init()}function B(i,l){for(var v=0;v<l.length;v++)i.removeAttr(l[v])}var s=KISSY.Editor,w=KISSY,t=s.RANGE,p=s.ElementPath,u=s.NODE,e=s.TripleButton,g="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var";removeFormatAttributes="class,style,lang,width,height,align,hspace,valign".split(",");g=new RegExp("^(?:"+g.replace(/,/g,"|")+")$","i");w.augment(q,{_init:function(){this.el=new e({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:this.editor.toolBarDiv});this.el.on("offClick",this._remove,this)},_remove:function(){var i=this.editor,l=g,v=removeFormatAttributes;l.lastIndex=0;i.focus();var k=i.getSelection().getRanges();i.fire("save");for(var m=0,o;o=k[m];m++)if(!o.collapsed){o.enlarge(t.ENLARGE_ELEMENT);var a=o.createBookmark(),c=a.startNode,j=a.endNode,f=function(h){for(var r=new p(h),b=r.elements,d=1,n;n=b[d];d++){if(n._4e_equals(r.block)||n._4e_equals(r.blockLimit))break;l.test(n.getName())&&
h.breakParent(n)}};f(c);f(j);for(c=c._4e_nextSourceNode(true,u.NODE_ELEMENT);c;){if(c._4e_equals(j))break;f=c._4e_nextSourceNode(false,u.NODE_ELEMENT);c._4e_name()=="img"&&c.attr("_cke_realelement")||(l.test(c._4e_name())?c._4e_remove(true):B(c,v));c=f}o.moveToBookmark(a)}i.getSelection().selectRanges(k);i.fire("save")}});z.addPlugin(function(){new q(z)})});
KISSY.Editor.add("smiley",function(z){var q=KISSY.Editor,B=KISSY,s=B.DOM,w=B.Event,t=B.Node,p=q.SimpleOverlay,u=q.TripleButton;q.Smiley||function(){function e(l){this.editor=l;this._init()}for(var g="<div class='ke-popup-wrap'><div class='ke-smiley-sprite'>",i=0;i<=98;i++)g+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+i+".gif'></a>";g+="</div></div>";B.augment(e,{_init:function(){this.el=new u({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:this.editor.toolBarDiv});
this.el.on("offClick",this._show,this);q.Utils.lazyRun(this,"_prepare","_real")},_hidePanel:function(l){var v=this;s._4e_ascendant(l.target,function(k){return k[0]===v.el.el[0]})||this.smileyWin.hide()},_selectSmiley:function(l){l.halt();var v=this.editor;l=l.target;var k;if(s._4e_name(l)=="a"&&(k=s.attr(l,"data-icon"))){k=new t("<img src='"+k+"'/>",null,v.document);v.insertElement(k);v.focus();this.smileyWin.hide()}},_prepare:function(){var l=this.editor;this.smileyPanel=new t(g);this.smileyWin=
new p({el:this.smileyPanel,mask:false});document.body.appendChild(this.smileyPanel[0]);this.smileyPanel.on("click",this._selectSmiley,this);w.on(document,"click",this._hidePanel,this);w.on(l.document,"click",this._hidePanel,this)},_real:function(){var l=this.el.el.offset();l.top+=this.el.el.height()+5;if(l.left+this.smileyPanel.width()>s.viewportWidth()-60)l.left=s.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.show(l)},_show:function(l){this._prepare(l)}});q.Smiley=e}();z.addPlugin(function(){new q.Smiley(z)})});
KISSY.Editor.add("sourcearea",function(z){var q=KISSY.Editor,B=KISSY,s=B.UA,w=q.TripleButton;q.SourceArea||function(){function t(p){this.editor=p;this._init()}B.augment(t,{_init:function(){var p=this.editor;this.el=new w({container:p.toolBarDiv,cls:"ke-tool-editor-source",title:"\u6e90\u7801",contentCls:"ke-toolbar-source"});this.el.on("offClick",this._show,this);this.el.on("onClick",this._hide,this);p.textarea.on("mousedown",function(u){u.stopPropagation()})},_show:function(){var p=this.editor,u=
this.el;p.textarea.val(p.getData());p._showSource();u.set("state",w.ON)},_hide:function(){var p=this.editor,u=p.textarea,e=this.el;p._hideSource();p.setData(u.val());if(s.gecko&&p.iframeFocus){e.el[0].focus();p.focus()}e.set("state",w.OFF)}});q.SourceArea=t}();z.addPlugin(function(){new q.SourceArea(z)})});
KISSY.Editor.add("table",function(z,q){console.log("table loaded!");var B=KISSY.Editor,s=KISSY,w=s.Node,t=s.DOM,p=B.Walker,u=s.UA,e=B.NODE,g=B.TripleButton,i=B.SimpleOverlay,l=B.ContextMenu,v=["tr","th","td","tbody","table"],k=s.trim,m;m=(u.ie===6?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[" table.%2,"," table.%2 > tr > td,  table.%2 > tr > th,"," table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,"," table.%2 > thead > tr > td,  table.%2 > thead > tr > th,",
" table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("").replace(/%2/g,"ke_show_border");B.TableUI||function(){function o(y){this.editor=y;this.selectedTable=null;y._toolbars=y._toolbars||{};y._toolbars.table=this;this._init()}function a(y){return k(y).length!=0}function c(y){function D($){if(!(N.length>0))if($[0].nodeType==e.NODE_ELEMENT&&C.test($._4e_name())&&!$._4e_getData("selected_cell")){$._4e_setMarker(M,"selected_cell",true);N.push($)}}for(var G=
y.createBookmarks(),J=y.getRanges(),N=[],M={},Q=0;Q<J.length;Q++){var R=J[Q];if(R.collapsed){R=R.getCommonAncestor();(R=R._4e_ascendant("td",true)||R._4e_ascendant("th",true))&&N.push(R)}else{R=new p(R);var W;for(R.guard=D;W=R.next();)if((W=W.parent())&&C.test(W._4e_name())&&!W._4e_getData("selected_cell")){W._4e_setMarker(M,"selected_cell",true);N.push(W)}}}B.Utils.clearAllMarkers(M);y.selectBookmarks(G);return N}function j(y){y=y.cells;for(var D=0;D<y.length;D++){y[D].innerHTML="";u.ie||(new w(y[D]))._4e_appendBogus()}}
function f(y,D){if(y=y.getStartElement()._4e_ascendant("tr")){var G=y._4e_clone(true);G.insertBefore(y);j(D?G[0]:y[0])}}function h(y){if(y instanceof B.Selection){var D=c(y),G=D.length;y=[];for(var J,N,M=0;M<G;M++){var Q=D[M].parent(),R=Q[0].rowIndex;!M&&(J=R-1);y[R]=Q;M==G-1&&(N=R+1)}M=Q._4e_ascendant("table");J=new w(N<M[0].rows.length&&M[0].rows[N]||J>0&&M[0].rows[J]||M[0].parentNode);for(M=y.length;M>=0;M--)y[M]&&h(y[M]);return J}else if(y instanceof w){M=y._4e_ascendant("table");M[0].rows.length==
1?M._4e_remove():y._4e_remove()}return 0}function r(y,D){y=y.getStartElement();if(y=y._4e_ascendant("td",true)||y._4e_ascendant("th",true))for(var G=y._4e_ascendant("table"),J=y[0].cellIndex,N=0;N<G[0].rows.length;N++){var M=G[0].rows[N];if(!(M.cells.length<J+1)){y=new w(M.cells[J].cloneNode(false));u.ie||y._4e_appendBogus();M=new w(M.cells[J]);D?y.insertBefore(M):y.insertAfter(M)}}}function b(y){var D=[],G=y[0]&&y[0]._4e_ascendant("table"),J,N,M,Q;J=0;for(N=y.length;J<N;J++)D.push(y[J][0].cellIndex);
D.sort();J=1;for(N=D.length;J<N;J++)if(D[J]-D[J-1]>1){M=D[J-1]+1;break}M||(M=D[0]>0?D[0]-1:D[D.length-1]+1);y=G[0].rows;J=0;for(N=y.length;J<N;J++)if(Q=y[J].cells[M])break;return Q?new w(Q):G.previous()}function d(y){if(y instanceof B.Selection){var D=c(y),G=b(D);for(y=D.length-1;y>=0;y--)D[y]&&d(D[y]);return G}else if(y instanceof w){D=y._4e_ascendant("table");if(!D)return null;G=y[0].cellIndex;for(y=D[0].rows.length-1;y>=0;y--){var J=new w(D[0].rows[y]);if(!G&&J[0].cells.length==1)h(J);else J[0].cells[G]&&
J[0].removeChild(J[0].cells[G])}}return null}function n(y,D){var G=new B.Range(y[0].ownerDocument);if(!G.moveToElementEditablePosition(y,D?true:q)){G.selectNodeContents(y);G.collapse(D?false:true)}G.select(true)}var A=B.HtmlDataProcessor,x=A&&A.dataFilter;A=A&&A.htmlFilter;x&&x.addRules({elements:{table:function(y){y=y.attributes;var D=y["class"],G=parseInt(y.border,10);if(!G||G<=0)y["class"]=(D||"")+" ke_show_border"}}});A&&A.addRules({elements:{table:function(y){y=y.attributes;var D=y["class"];
if(D)y["class"]=s.trim(D.replace("ke_show_border","").replace(/\s{2}/," "))}}});s.augment(o,{_init:function(){var y=this.editor,D={};this.el=new g({contentCls:"ke-toolbar-table",title:"\u8868\u683c",container:y.toolBarDiv});this.el.on("offClick",this._tableShow,this);for(var G in I)(function(J){D[J]=function(){y.fire("save");y.focus();I[J](y);y.fire("save")}})(G);l.register(y.document,{tags:v,width:"120px",funcs:D});B.Utils.lazyRun(this,"_prepareTableShow","_realTableShow")},_tableInit:function(){var y=
this,D=y.editor,G=new i({width:"350px",mask:true,title:"\u7f16\u8f91\u8868\u683c"});G.body.html("<table class='ke-table-config'><tr><td><label>\u884c\u6570\uff1a <input value='2' class='ke-table-rows ke-table-create-only' size='8'/></label></td><td><label>\u5bbd\u5ea6\uff1a <input value='200' class='ke-table-width' size='8'/></label> <select class='ke-table-width-unit'><option value='px'>\u50cf\u7d20</option><option value='%'>\u767e\u5206\u6bd4</option></select></td></tr><tr><td><label>\u5217\u6570\uff1a <input class='ke-table-cols ke-table-create-only' value='3' size='8'/></label></td><td><label>\u9ad8\u5ea6\uff1a <input value='200' class='ke-table-height' size='8'/></label> &nbsp;\u50cf\u7d20</select></td></tr><tr><td><label>\u6807\u9898\u683c\uff1a <select class='ke-table-head ke-table-create-only'><option value=''>\u65e0</option><option value='1'>\u6709</option></select></td><td><label>\u95f4\u8ddd\uff1a <input value='1' class='ke-table-cellspacing' size='8'/></label> &nbsp;\u50cf\u7d20</select></td></tr><tr><td><label>\u5bf9\u9f50\uff1a <select class='ke-table-align'><option value=''>\u65e0</option><option value='left'>\u5de6\u5bf9\u9f50</option><option value='right'>\u53f3\u5bf9\u9f50</option><option value='center'>\u4e2d\u95f4\u5bf9\u9f50</option></select></label></td><td><label>\u8fb9\u8ddd\uff1a <input value='1' class='ke-table-cellpadding' size='8'/></label> &nbsp;\u50cf\u7d20</select></td></tr><tr><td></td><td><label>\u8fb9\u6846\uff1a <input value='1' class='ke-table-border' size='8'/></label> &nbsp;\u50cf\u7d20</select></td></tr><tr><td colspan='2'><label>\u6807\u9898\uff1a<input class='ke-table-caption' style='width:270px'></label></td></tr><tr><td colspan='2' style='text-align:center'><button class='ke-table-ok'>\u786e\u5b9a</button></td></tr></table>");
G.twidth=G.body.one(".ke-table-width");G.theight=G.body.one(".ke-table-height");G.tcellspacing=G.body.one(".ke-table-cellspacing");G.tcellpadding=G.body.one(".ke-table-cellpadding");G.tborder=G.body.one(".ke-table-border");G.tcaption=G.body.one(".ke-table-caption");G.talign=G.body.one(".ke-table-align");G.trows=G.body.one(".ke-table-rows");G.tcols=G.body.one(".ke-table-cols");G.thead=G.body.one(".ke-table-head");G.tok=G.body.one(".ke-table-ok");G.tclose=G.body.one(".ke-table-close");G.twidthunit=
G.body.one(".ke-table-width-unit");y.tableDialog=G;G.tok.on("click",y._tableOk,y);G.on("hide",function(){y.selectedTable=null;D.focus()})},_tableOk:function(){this.selectedTable?this._modifyTable():this._genTable()},_modifyTable:function(){var y=this.tableDialog,D=this.selectedTable,G=D.one("caption");a(y.talign.val())&&D.attr("align",k(y.talign.val()));a(y.tcellspacing.val())&&D.attr("cellspacing",k(y.tcellspacing.val()));a(y.tcellpadding.val())&&D.attr("cellpadding",k(y.tcellpadding.val()));a(y.tborder.val())&&
D.attr("border",k(y.tborder.val()));!a(y.tborder.val())||y.tborder.val()=="0"?D.addClass("ke_show_border"):D.remoevClass("ke_show_border");a(y.twidth.val())&&D.css("width",k(y.twidth.val())+y.twidthunit.val());a(y.theight.val())&&D.css("height",k(y.theight.val()));if(a(y.tcaption.val()))G&&G[0]?G.html(k(y.tcaption.val())):(new w("<caption><span>"+k(y.tcaption.val())+"</span></caption>")).insertBefore(D[0].firstChild);else G&&G._4e_remove();y.hide()},_genTable:function(){var y=this.tableDialog,D="<table ",
G,J=parseInt(y.tcols.val()),N=parseInt(y.trows.val()),M=u.ie?"":"<br/>",Q=this.editor;if(s.trim(y.talign.val()).length!=0)D+="align='"+s.trim(y.talign.val())+"' ";if(s.trim(y.tcellspacing.val()).length!=0)D+="cellspacing='"+s.trim(y.tcellspacing.val())+"' ";if(s.trim(y.tcellpadding.val()).length!=0)D+="cellpadding='"+s.trim(y.tcellpadding.val())+"' ";if(s.trim(y.tborder.val()).length!=0)D+="border='"+s.trim(y.tborder.val())+"' ";if(s.trim(y.twidth.val()).length!=0||s.trim(y.theight.val()).length!=
0){D+="style='";if(s.trim(y.twidth.val()).length!=0)D+="width:"+s.trim(y.twidth.val())+y.twidthunit.val()+";";if(s.trim(y.theight.val()).length!=0)D+="height:"+s.trim(y.theight.val())+"px;";D+="' "}if(s.trim(y.tborder.val()).length==0||s.trim(y.tborder.val())=="0")D+="class='ke_show_border' ";D+=">";if(s.trim(y.tcaption.val()))D+="<caption><span>"+s.trim(y.tcaption.val())+"</span></caption>";if(y.thead.val()){D+="<thead>";D+="<tr>";for(G=0;G<J;G++)D+="<th>"+M+"</th>";D+="</tr>";D+="</thead>"}D+="<tbody>";
for(var R=0;R<N;R++){D+="<tr>";for(G=0;G<J;G++)D+="<td>"+M+"</td>";D+="</tr>"}D+="</tbody>";D+="</table>";D=new w(D,null,Q.document);Q.insertElement(D);y.hide()},_fillTableDialog:function(){var y=this.tableDialog,D=this.selectedTable,G=D.one("caption");y.talign.val(D.attr("align")||"");y.tcellspacing.val(D.attr("cellspacing")||"");y.tcellpadding.val(D.attr("cellpadding")||"");y.tborder.val(D.attr("border")|"");var J=D._4e_style("width")||"";y.twidth.val(J.replace(/px|%/i,""));J.indexOf("%")!=-1?y.twidthunit.val("%"):
y.twidthunit.val("px");y.theight.val((D._4e_style("height")||"").replace(/px|%/i,""));J="";if(G)J=G.text();y.tcaption.val(J);y.trows.val(D.one("tbody").children().length);y.tcols.val(D.one("tr").children().length);y.thead.val(D._4e_first(function(N){return N._4e_name()=="thead"})?"1":"")},_realTableShow:function(){if(this.selectedTable){this._fillTableDialog();this.tableDialog.body.all(".ke-table-create-only").attr("disabled","disabled")}else this.tableDialog.body.all(".ke-table-create-only").removeAttr("disabled");
this.tableDialog.show()},_prepareTableShow:function(){this._tableInit()},_tableShow:function(){this._prepareTableShow()}});var C=/^(?:td|th)$/,I={"\u8868\u683c\u5c5e\u6027":function(y){var D=y.getSelection();if(D=(D=D&&D.getStartElement())&&D._4e_ascendant("table",true)){y=y._toolbars.table;y.selectedTable=D;y._tableShow()}},"\u5220\u9664\u8868\u683c":function(y){var D=(y=y.getSelection())&&y.getStartElement();if(D=D&&D._4e_ascendant("table",true)){y.selectElement(D);var G=y.getRanges()[0];G.collapse();
y.selectRanges([G]);y=D.parent();y[0].childNodes.length==1&&y._4e_name()!="body"?y._4e_remove():D._4e_remove()}},"\u5220\u9664\u884c":function(y){y=y.getSelection();n(h(y),q)},"\u5220\u9664\u5217":function(y){y=y.getSelection();(y=d(y))&&n(y,true)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(y){y=y.getSelection();f(y,true)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(y){y=y.getSelection();f(y,q)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(y){y=y.getSelection();r(y,true)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(y){y=
y.getSelection();r(y,q)}};B.TableUI=o}();z.addPlugin(function(){var o=z.document;new B.TableUI(z);var a=t.create("<style>",null,o);o.getElementsByTagName("head")[0].appendChild(a);if(a.styleSheet)a.styleSheet.cssText=m;else a.appendChild(o.createTextNode(m))})});
KISSY.Editor.add("templates",function(z){var q=KISSY.Editor,B=KISSY,s=B.Node,w=q.TripleButton,t=q.SimpleOverlay;q.TplUI||function(){function p(u){this.editor=u;this._init()}B.augment(p,{_init:function(){(new w({container:this.editor.toolBarDiv,contentCls:"ke-toolbar-template",title:"\u6a21\u677f"})).on("click",this._show,this);q.Utils.lazyRun(this,"_prepare","_real")},_prepare:function(){for(var u=this.editor,e=u.cfg.pluginConfig.templates,g="<div class='ke-tpl'>",i=0;i<e.length;i++)g+="<a href='javascript:void(0)' class='ke-tpl-list' tabIndex='-1'>"+
e[i].demo+"</a>";g+="</div>";this._initDialogOk=true;var l=new t({mask:true,title:"\u5185\u5bb9\u6a21\u677f"});l.body.html(g);g=l.body.all(".ke-tpl-list");l.on("hide",function(){u.focus()});g.on("click",function(v){v.halt();v=(new s(v.target))._4e_index();v!=-1&&u.insertHtml(e[v].html);l.hide()});this.ui=l},_real:function(){this.ui.show()},_show:function(){this._prepare()}});q.TplUI=p}();z.addPlugin(function(){new q.TplUI(z)})});
KISSY.Editor.add("undo",function(z){var q=KISSY.Editor,B=KISSY,s=q.Utils.arrayCompare,w=B.UA,t=B.Event;q.UndoManager||function(){function p(m){var o=m._getRawData();m=o&&m.getSelection();this.contents=o;this.bookmarks=m&&m.createBookmarks2(true)}function u(m,o,a){this.s=m;this.fn=o;this.scope=a||window;this.bufferTimer=null}function e(m){this.history=[];this.index=0;this.editor=m;this.bufferTimer=new u(500,this.save,this);this._init()}function g(m,o,a,c){this.editor=m;this.title=a;this.text=o;this.contentCls=
c;this._init()}B.augment(p,{equals:function(m){if(this.contents!=m.contents)return false;var o=this.bookmarks;m=m.bookmarks;if(o||m){if(!o||!m||o.length!=m.length)return false;for(var a=0;a<o.length;a++){var c=o[a],j=m[a];if(c.startOffset!=j.startOffset||c.endOffset!=j.endOffset||!s(c.start,j.start)||!s(c.end,j.end))return false}}return true}});B.augment(u,{run:function(){if(this.bufferTimer){clearTimeout(this.bufferTimer);this.bufferTimer=null}var m=this;this.bufferTimer=setTimeout(function(){m.fn.call(m.scope)},
this.s)}});var i={16:1,17:1,18:1},l={37:1,38:1,39:1,40:1};B.augment(e,{_keyMonitor:function(){var m=this.editor;t.on(m.document,"keydown",function(o){var a=o.keyCode;if(!(a in l||a in i))if(a===90&&(o.ctrlKey||o.metaKey)){m.fire("restore",{d:-1});o.halt()}else if(a===89&&(o.ctrlKey||o.metaKey)){m.fire("restore",{d:1});o.halt()}else m.fire("save",{buffer:1})})},_init:function(){var m=this,o=m.editor;o.on("save",function(a){a.buffer?m.bufferTimer.run():m.save()});o.on("restore",this.restore,this);m._keyMonitor()},
save:function(){this.history.length>this.index+1&&this.history.splice(this.index+1,this.history.length-this.index-1);var m=this.editor,o=this.history.length>0?this.history[this.history.length-1]:null,a=new p(this.editor);if(!o||!o.equals(a)){this.history.length===30&&this.history.shift();this.history.push(a);this.index=this.history.length-1;m.fire("afterSave",{history:this.history,index:this.index})}},restore:function(m){m=m.d;var o=this.editor,a=this.history.length>0?this.history[this.index+m]:null;
if(a){o._setRawData(a.contents);if(a.bookmarks)this.editor.getSelection().selectBookmarks(a.bookmarks);else if(w.ie){a=this.editor.document.body.createTextRange();a.collapse(true);a.select()}this.index+=m;o.fire("afterRestore",{history:this.history,index:this.index})}}});var v=q.TripleButton,k={redo:1,undo:-1};B.augment(g,{_init:function(){var m=this,o=m.editor;m.el=new v({contentCls:m.contentCls,title:m.title,container:o.toolBarDiv});this.el.set("state",v.DISABLED);o.on("afterSave",this._respond,
this);o.on("afterRestore",this._respond,this);m.el.on("offClick",function(){o.fire("restore",{d:k[m.text]})})},_respond:function(m){this.updateUI(m.history,m.index)},updateUI:function(m,o){if(this.text=="undo")o>0&&m.length>0?this.el.set("state",v.OFF):this.el.set("state",v.DISABLED);else if(this.text=="redo")o<m.length-1?this.el.set("state",v.OFF):this.el.set("state",v.DISABLED)}});q.UndoManager=e;q.RestoreUI=g}();z.addPlugin(function(){new q.UndoManager(z);new q.RestoreUI(z,"undo","\u64a4\u9500",
"ke-toolbar-undo");new q.RestoreUI(z,"redo","\u91cd\u505a","ke-toolbar-redo")})});
