KISSY.Editor.add("contextmenu",function(){function e(a){this.cfg=h.clone(a);j.Utils.lazyRun(this,"_prepareShow","_realShow")}var j=KISSY.Editor,h=KISSY,m=h.Node,n=h.Event,d=[];e.register=function(a,b){var i=new e(b);d.push({doc:a,tags:b.tags,instance:i});if(!a.ke_contextmenu){a.ke_contextmenu=1;n.on(a,"mousedown",e.hide);n.on(a,"contextmenu",function(c){e.hide.call(this);for(var f=new m(c.target);f;){var k=f._4e_name(),l=false;if(k=="body")break;for(var g=0;g<d.length;g++){var o=d[g].tags,p=d[g].instance;
if(a===d[g].doc&&h.inArray(k,o)){c.preventDefault();l=true;p.show(j.Utils.getXY(c.pageX,c.pageY,a,document));break}}if(l)break;f=f.parent()}})}return i};e.hide=function(){for(var a=0;a<d.length;a++){var b=d[a].instance;this===d[a].doc&&b.hide()}};var q=j.SimpleOverlay;h.augment(e,{_init:function(){var a=this,b=a.cfg,i=b.funcs;a.elDom=new m("<div class='ke-contextmenu'></div>");var c=a.elDom;c.css("width",b.width);document.body.appendChild(c[0]);a.el=new q({el:c});for(var f in i){b=new m("<a href='#'>"+
f+"</a>");c[0].appendChild(b[0]);(function(k,l){k.on("click",function(g){l();a.hide();g.halt()})})(b,i[f])}},hide:function(){this.el&&this.el.hide()},_realShow:function(a){this.el.show(a)},_prepareShow:function(){this._init()},show:function(a){this._prepareShow(a)}});j.ContextMenu=e});
