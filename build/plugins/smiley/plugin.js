KISSY.Editor.add("smiley",function(i){var b=KISSY.Editor,f=KISSY,d=f.DOM,j=f.Event,k=f.Node,m=b.SimpleOverlay,n=b.TripleButton;b.Smiley||function(){function l(a){this.editor=a;this._init()}for(var g="<div class='ke-popup-wrap'><div class='ke-smiley-sprite'>",h=0;h<=98;h++)g+="<a href='#' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+h+".gif'></a>";g+="</div></div>";f.augment(l,{_init:function(){this.el=new n({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",container:this.editor.toolBarDiv});
this.el.on("offClick",this._show,this);b.Utils.lazyRun(this,"_prepare","_real")},_hidePanel:function(a){var e=this;d._4e_ascendant(a.target,function(c){return c[0]===e.el.el[0]})||this.smileyWin.hide()},_selectSmiley:function(a){a.halt();var e=this.editor;a=a.target;var c;if(d._4e_name(a)=="a"&&(c=d.attr(a,"data-icon"))){c=new k("<img src='"+c+"'/>",null,e.document);e.insertElement(c);e.focus();this.smileyWin.hide()}},_prepare:function(){var a=this.editor;this.smileyPanel=new k(g);this.smileyWin=
new m({el:this.smileyPanel,mask:false});document.body.appendChild(this.smileyPanel[0]);this.smileyPanel.on("click",this._selectSmiley,this);j.on(document,"click",this._hidePanel,this);j.on(a.document,"click",this._hidePanel,this)},_real:function(){var a=this.el.el.offset();a.top+=this.el.el.height()+5;if(a.left+this.smileyPanel.width()>d.viewportWidth()-60)a.left=d.viewportWidth()-this.smileyPanel.width()-60;this.smileyWin.show(a)},_show:function(a){this._prepare(a)}});b.Smiley=l}();i.addPlugin(function(){new b.Smiley(i)})});
