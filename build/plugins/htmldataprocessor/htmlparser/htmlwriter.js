KISSY.Editor.add("htmlparser-htmlwriter",function(){function e(){e.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=false;this.sortAttributes=true;this._.indent=false;this._.indentation="";this._.rules={};var a=c.XHTML_DTD;for(var b in d.mix({},a.$nonBodyContent,a.$block,a.$listItem,a.$tableContent))this.setRules(b,{indent:true,breakBeforeOpen:true,breakAfterOpen:true,breakBeforeClose:!a[b]["#"],breakAfterClose:true});
this.setRules("br",{breakAfterOpen:true});this.setRules("title",{indent:false,breakAfterOpen:false});this.setRules("style",{indent:false,breakBeforeClose:true});this.setRules("pre",{indent:false})}var c=KISSY.Editor,d=c.Utils;if(!c.HtmlParser.HtmlWriter){KISSY.extend(e,c.HtmlParser.BasicWriter,{openTag:function(a){var b=this._.rules[a];if(this._.indent)this.indentation();else if(b&&b.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",a)},openTagClose:function(a,b){a=this._.rules[a];
if(b)this._.output.push(this.selfClosingEnd);else{this._.output.push(">");if(a&&a.indent)this._.indentation+=this.indentationChars}a&&a.breakAfterOpen&&this.lineBreak()},attribute:function(a,b){if(typeof b=="string"){this.forceSimpleAmpersand&&(b=b.replace(/&amp;/g,"&"));b=d.htmlEncodeAttr(b)}this._.output.push(" ",a,'="',b,'"')},closeTag:function(a){var b=this._.rules[a];if(b&&b.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();
else if(b&&b.breakBeforeClose){this.lineBreak();this.indentation()}this._.output.push("</",a,">");b&&b.breakAfterClose&&this.lineBreak()},text:function(a){if(this._.indent){this.indentation();a=d.ltrim(a)}this._.output.push(a)},comment:function(a){this._.indent&&this.indentation();this._.output.push("<!--",a,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=true},indentation:function(){this._.output.push(this._.indentation);this._.indent=false},
setRules:function(a,b){var f=this._.rules[a];if(f)d.mix(f,b);else this._.rules[a]=b}});c.HtmlParser.HtmlWriter=e}});
