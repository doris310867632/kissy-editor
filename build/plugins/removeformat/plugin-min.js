KISSY.Editor.add("removeformat",function(l){function m(b){this.editor=b;this._init()}function t(b,c){for(var d=0;d<c.length;d++)b.removeAttr(c[d])}var g=KISSY.Editor,u=KISSY,v=g.RANGE,w=g.ElementPath,n=g.NODE,x=g.TripleButton,i="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var";removeFormatAttributes="class,style,lang,width,height,align,hspace,valign".split(",");i=new RegExp("^(?:"+i.replace(/,/g,"|")+")$","i");u.augment(m,{_init:function(){this.el=new x({title:"\u6e05\u9664\u683c\u5f0f",
contentCls:"ke-toolbar-removeformat",container:this.editor.toolBarDiv});this.el.on("offClick",this._remove,this)},_remove:function(){var b=this.editor,c=i,d=removeFormatAttributes;c.lastIndex=0;b.focus();var o=b.getSelection().getRanges();b.fire("save");for(var p=0,e;e=o[p];p++)if(!e.collapsed){e.enlarge(v.ENLARGE_ELEMENT);var j=e.createBookmark(),a=j.startNode,q=j.endNode,h=function(r){for(var k=new w(r),y=k.elements,s=1,f;f=y[s];s++){if(f._4e_equals(k.block)||f._4e_equals(k.blockLimit))break;c.test(f.getName())&&
r.breakParent(f)}};h(a);h(q);for(a=a._4e_nextSourceNode(true,n.NODE_ELEMENT);a;){if(a._4e_equals(q))break;h=a._4e_nextSourceNode(false,n.NODE_ELEMENT);a._4e_name()=="img"&&a.attr("_cke_realelement")||(c.test(a._4e_name())?a._4e_remove(true):t(a,d));a=h}e.moveToBookmark(j)}b.getSelection().selectRanges(o);b.fire("save")}});l.addPlugin(function(){new m(l)})});
