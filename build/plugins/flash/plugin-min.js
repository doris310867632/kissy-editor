KISSY.Editor.add("flash",function(i){var c=KISSY.Editor,j=KISSY,n=j.Node,o=c.TripleButton,p=c.SimpleOverlay,q=/\.swf(?:$|\?)/i,e=c.HtmlDataProcessor,r="niftyplayer.swf",k=e&&e.dataFilter;c.Flash||function(){function l(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||q.test(a.src||"")}function g(a){return a.indexOf(r)!=-1}function m(a){this.editor=a;this._init()}k&&k.addRules({elements:{object:function(a){var b=a.attributes,d="ke_flash",f="flash";if(!(b.classid&&String(b.classid).toLowerCase())){for(b=
0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!l(a.children[b]))return null;if(g(a.children[b].attributes.src)){d="ke_music";f="music"}return e.createFakeParserElement(a,d,f,true)}return null}for(b=0;b<a.children.length;b++){var h=a.children[b];if(h.name=="param"&&h.attributes.name=="movie")if(g(h.attributes.value)){d="ke_music";f="music";break}}return e.createFakeParserElement(a,d,f,true)},embed:function(a){if(!l(a))return null;var b="ke_flash",d="flash";if(g(a.attributes.src)){b=
"ke_music";d="music"}return e.createFakeParserElement(a,b,d,true)}}},5);j.augment(m,{_init:function(){this.el=new o({container:this.editor.toolBarDiv,contentCls:"ke-toolbar-flash",title:"Flash"});this.el.on("click",this._showConfig,this);c.Utils.lazyRun(this,"_prepareShow","_realShow")},_prepareShow:function(){this.d=new p({title:"\u7f16\u8f91flash",width:"350px",mask:true});this.d.body.html("<div style='margin:10px;'><p><label>\u5730\u5740\uff1a<input class='ke-flash-url' style='width:280px' /></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\uff1a<input class='ke-flash-width' style='width:120px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\uff1a<input class='ke-flash-height' style='width:110px' /></label></p><p style='margin:5px 0;text-align:right;'><button>\u786e\u5b9a</button></p></div>");
this._initD()},_realShow:function(){this.d.show()},_showConfig:function(){this._prepareShow()},_initD:function(){var a=this.d;this.dHeight=a.el.one(".ke-flash-height");this.dWidth=a.el.one(".ke-flash-width");this.dUrl=a.el.one(".ke-flash-url");a.el.one("button").on("click",this._gen,this)},_gen:function(){var a=this.editor,b=this.dUrl.val();if(b){b=new n("<object "+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+
"' ":" ")+'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="quality" value="high" /><param name="movie" value="'+b+'" /><embed '+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+"' ":" ")+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+b+'" type="application/x-shockwave-flash"></embed></object>',
null,a.document);b=a.createFakeElement?a.createFakeElement(b,"ke_flash","flash",true):b;a.insertElement(b);this.d.hide()}}});c.Flash=m}();i.addPlugin(function(){new c.Flash(i)})});
