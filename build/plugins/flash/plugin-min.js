KISSY.Editor.add("flash",function(i){var e=KISSY.Editor,j=KISSY,p=j.Event,q=e.ContextMenu,l=j.Node,r=e.TripleButton,s=e.SimpleOverlay,t=/\.swf(?:$|\?)/i,h=e.HtmlDataProcessor,u="niftyplayer.swf",m=h&&h.dataFilter,v=["img.ke_flash"];e.Flash||function(){function f(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||t.test(a.src||"")}function d(a){return a.indexOf(u)!=-1}function n(a){this.editor=a;a._toolbars=a._toolbars||{};a._toolbars.flash=this;this._init()}m&&m.addRules({elements:{"ke:object":function(a){var b=
a.attributes,c="ke_flash",g="flash";if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="ke:embed"){if(!f(a.children[b]))return null;if(d(a.children[b].attributes.src)){c="ke_music";g="music"}return h.createFakeParserElement(a,c,g,true)}return null}for(b=0;b<a.children.length;b++){var k=a.children[b];if(k.name=="ke:param"&&k.attributes.name=="movie")if(d(k.attributes.value)){c="ke_music";g="music";break}}return h.createFakeParserElement(a,c,g,true)},
"ke:embed":function(a){if(!f(a))return null;var b="ke_flash",c="flash";if(d(a.attributes.src)){b="ke_music";c="music"}return h.createFakeParserElement(a,b,c,true)}}},5);j.augment(n,{_init:function(){var a=this.editor,b={};this.el=new r({container:a.toolBarDiv,contentCls:"ke-toolbar-flash",title:"Flash"});this.el.on("click",this._showConfig,this);p.on(a.document,"dblclick",this._dbclick,this);for(var c in o)(function(g){b[g]=function(){a.fire("save");a.focus();o[g](a);a.fire("save")}})(c);q.register(a.document,
{rules:v,width:"120px",funcs:b});e.Utils.lazyRun(this,"_prepareShow","_realShow")},_dbclick:function(a){var b=new l(a.target);if(b._4e_name()==="img"&&b.hasClass("ke_flash")){this.selectedFlash=b;this._showConfig();a.halt()}},_prepareShow:function(){var a=this;a.d=new s({title:"\u7f16\u8f91flash",width:"350px",mask:true});a.d.on("hide",function(){a.selectedFlash=null;i.focus()});a.d.body.html("<div style='margin:10px;'><p><label>\u5730\u5740\uff1a<input class='ke-flash-url' style='width:280px' /></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\uff1a<input class='ke-flash-width' style='width:120px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\uff1a<input class='ke-flash-height' style='width:110px' /></label></p><p style='margin:5px 0;text-align:right;'><button>\u786e\u5b9a</button></p></div>");
a._initD()},_realShow:function(){this.d.show()},_showConfig:function(){var a=this.editor,b=this.selectedFlash;this._prepareShow();if(b){b=a.restoreRealElement(b);b.attr("width")&&this.dWidth.val(parseInt(b.attr("width")));b.attr("height")&&this.dHeight.val(parseInt(b.attr("height")));if(b._4e_name()=="ke:object"){var c=b._4e_getElementsByTagName("param","ke");for(a=0;a<c.length;a++)if((c[a].attr("name")||"").toLowerCase()=="movie")this.dUrl.val(c[a].attr("value"));c=b._4e_getElementsByTagName("embed",
"ke");for(a=0;a<c.length;a++)this.dUrl.val(c[a].attr("src"));b=b._4e_getElementsByTagName("object","ke");for(a=0;a<b.length;a++)this.dUrl.val(b[a].attr("data"))}else b._4e_name()=="ke:embed"&&this.dUrl.val(b.attr("src"))}},_initD:function(){var a=this.d;this.dHeight=a.el.one(".ke-flash-height");this.dWidth=a.el.one(".ke-flash-width");this.dUrl=a.el.one(".ke-flash-url");a.el.one("button").on("click",this._gen,this)},_gen:function(){var a=this.editor,b=this.dUrl.val();if(b){b=new l("<ke:object "+(parseInt(this.dWidth.val())?
" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+"' ":" ")+'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><ke:param name="quality" value="high" ></ke:param><ke:param name="movie" value="'+b+'" ></ke:param><ke:embed '+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+
parseInt(this.dHeight.val())+"' ":" ")+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+b+'" type="application/x-shockwave-flash"></ke:embed></ke:object>',null,a.document);b=a.createFakeElement?a.createFakeElement(b,"ke_flash","flash",true):b;a.insertElement(b);this.d.hide()}}});e.Flash=n}();var o={"\u7f16\u8f91Flash":function(f){var d=f.getSelection();if(d=(d=d&&d.getStartElement())&&d._4e_ascendant("img",true))if(d.hasClass("ke_flash")){f=f._toolbars.flash;f.selectedFlash=
d;f._showConfig()}}};i.addPlugin(function(){new e.Flash(i)})});
