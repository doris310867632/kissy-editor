KISSY.Editor.add("flash",function(j){var e=KISSY.Editor,i=KISSY,l=i.DOM,q=i.Event,r=e.ContextMenu,m=i.Node,s=e.TripleButton,t=e.SimpleOverlay,u=/\.swf(?:$|\?)/i,h=e.HtmlDataProcessor,v="niftyplayer.swf",n=h&&h.dataFilter,w=["img.ke_flash"];e.Flash||function(){function f(a){a=a.attributes;return a.type=="application/x-shockwave-flash"||u.test(a.src||"")}function c(a){return a.indexOf(v)!=-1}function o(a){this.editor=a;a._toolbars=a._toolbars||{};a._toolbars.flash=this;this._init()}n&&n.addRules({elements:{object:function(a){var b=
a.attributes,d="ke_flash",g="flash";if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!f(a.children[b]))return null;if(c(a.children[b].attributes.src)){d="ke_music";g="music"}return h.createFakeParserElement(a,d,g,true)}return null}for(b=0;b<a.children.length;b++){var k=a.children[b];if(k.name=="param"&&k.attributes.name=="movie")if(c(k.attributes.value)){d="ke_music";g="music";break}}return h.createFakeParserElement(a,d,g,true)},
embed:function(a){if(!f(a))return null;var b="ke_flash",d="flash";if(c(a.attributes.src)){b="ke_music";d="music"}return h.createFakeParserElement(a,b,d,true)}}},5);i.augment(o,{_init:function(){var a=this.editor,b={};this.el=new s({container:a.toolBarDiv,contentCls:"ke-toolbar-flash",title:"Flash"});this.el.on("click",this._showConfig,this);q.on(a.document,"dblclick",this._dbclick,this);for(var d in p)(function(g){b[g]=function(){a.fire("save");a.focus();p[g](a);a.fire("save")}})(d);r.register(a.document,
{rules:w,width:"120px",funcs:b});e.Utils.lazyRun(this,"_prepareShow","_realShow")},_dbclick:function(a){var b=new m(a.target);if(b._4e_name()==="img"&&b.hasClass("ke_flash")){this.selectedFlash=b;this._showConfig();a.halt()}},_prepareShow:function(){var a=this;a.d=new t({title:"\u7f16\u8f91flash",width:"350px",mask:true});a.d.on("hide",function(){a.selectedFlash=null;j.focus()});a.d.body.html("<div style='margin:10px;'><p><label>\u5730\u5740\uff1a<input class='ke-flash-url' style='width:280px' /></label></p><p style='margin:5px 0'><label>\u5bbd\u5ea6\uff1a<input class='ke-flash-width' style='width:120px' /></label>&nbsp;&nbsp;<label>\u9ad8\u5ea6\uff1a<input class='ke-flash-height' style='width:110px' /></label></p><p style='margin:5px 0;text-align:right;'><button>\u786e\u5b9a</button></p></div>");
a._initD()},_realShow:function(){this.d.show()},_showConfig:function(){var a=this.editor,b=this.selectedFlash;this._prepareShow();if(b){a=a.restoreRealElement(b);a.attr("width")&&this.dWidth.val(parseInt(a.attr("width")));a.attr("height")&&this.dHeight.val(parseInt(a.attr("height")));if(a._4e_name()=="object"){a=a.all("param");for(b=0;b<a.length;b++)l.attr(a[b],"name")=="movie"&&this.dUrl.val(l.attr(a[b],"value"))}else a._4e_name()=="embed"&&this.dUrl.val(a.attr("src"))}},_initD:function(){var a=
this.d;this.dHeight=a.el.one(".ke-flash-height");this.dWidth=a.el.one(".ke-flash-width");this.dUrl=a.el.one(".ke-flash-url");a.el.one("button").on("click",this._gen,this)},_gen:function(){var a=this.editor,b=this.dUrl.val();if(b){b=new m("<object "+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+"' ":" ")+'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="quality" value="high" /><param name="movie" value="'+
b+'" /><embed '+(parseInt(this.dWidth.val())?" width='"+parseInt(this.dWidth.val())+"' ":" ")+(parseInt(this.dHeight.val())?" height='"+parseInt(this.dHeight.val())+"' ":" ")+'pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+b+'" type="application/x-shockwave-flash"></embed></object>',null,a.document);b=a.createFakeElement?a.createFakeElement(b,"ke_flash","flash",true):b;a.insertElement(b);this.d.hide()}}});e.Flash=o}();var p={"\u7f16\u8f91Flash":function(f){var c=f.getSelection();
if(c=(c=c&&c.getStartElement())&&c._4e_ascendant("img",true))if(c.hasClass("ke_flash")){f=f._toolbars.flash;f.selectedFlash=c;f._showConfig()}}};j.addPlugin(function(){new e.Flash(j)})});
